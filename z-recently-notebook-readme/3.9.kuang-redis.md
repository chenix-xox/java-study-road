# å§‹äº 2024.3.15



# 3Vå’Œ3é«˜

å¤§æ•°æ®æ—¶ä»£çš„3V

- æµ·é‡Volume
- å¤šæ ·Variety
- å®æ—¶Velocity



äº’è”ç½‘éœ€æ±‚çš„3é«˜

- é«˜å¹¶å‘
- é«˜å¯æ‹“
- é«˜æ€§èƒ½





# æ‚è°ˆ

[é˜¿é‡Œäº‘çš„è¿™ç¾¤ç–¯å­](https://www.huxiu.com/article/267100.html)



> - å•†å“åŸºæœ¬ä¿¡æ¯
>
>   åç§°ã€ä»·æ ¼ã€å•†å®¶ä¿¡æ¯...
>
>   MySQL
>
> - å•†å“çš„æè¿°ã€è¯„è®ºï¼ˆæ–‡å­—è¾ƒå¤šï¼‰
>
>   æ–‡æ¡£å‹æ•°æ®åº“ï¼ŒMongoDB
>
> - å›¾ç‰‡
>
>   åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ FastDFS
>
>   é˜¿é‡Œäº‘ï¼šOSS
>
>   Hadoopï¼šHDFS
>
> - å•†å“å…³é”®å­—ï¼ˆæœç´¢ï¼‰
>
>   æœç´¢å¼•æ“ï¼šsolr / elasticsearch
>
>   Isearchï¼šé˜¿é‡Œ-å¤šéš†
>
> - å•†å“çƒ­é—¨çš„æ³¢æ®µä¿¡æ¯
>
>   å†…å­˜æ•°æ®åº“ï¼šRedisã€Tairã€Memache...
>
> - å•†å“äº¤æ˜“ã€å¤–éƒ¨çš„æ”¯ä»˜æ¥å£
>
>   ç¬¬ä¸‰æ–¹åº”ç”¨



**MongoDBï¼š**

ä»‹äºå…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»ç³»æ•°æ®åº“ä¹‹é—´ï¼Œæ˜¯éå…³ç³»å‹æ•°æ®åº“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»å‹æ•°æ®åº“çš„





# æ¦‚è¿°

**èƒ½å¹²ä»€ä¹ˆ**

1. å†…å­˜å­˜å‚¨ã€æŒä¹…åŒ–ï¼Œå†…å­˜ä¸­æ˜¯æ–­ç”µå³å¤±ã€æ‰€ä»¥è¯´æŒä¹…åŒ–å¾ˆé‡è¦(rdbã€aof)
2. æ•ˆç‡é«˜ï¼Œå¯ä»¥ç”¨äºé«˜é€Ÿç¼“å­˜
3. å‘å¸ƒè®¢é˜…ç³»ç»Ÿ
4. åœ°å›¾ä¿¡æ¯åˆ†æ
5. è®¡æ—¶å™¨ã€è®¡æ•°å™¨ï¼ˆæµè§ˆé‡ï¼ï¼‰



**ç‰¹æ€§**

1. å¤šæ ·çš„æ•°æ®ç±»å‹
2. æŒä¹…åŒ–
3. é›†ç¾¤
4. äº‹åŠ¡
5. ...



# å®‰è£…

1. ä¸‹è½½redis-7.2.4.tar.gz	

2. æ”¾åˆ°optç›®å½•ä¸‹

   ```bash
   mv redis-7.2.4.tar.gz /opt
   ```

3. åœ¨optç›®å½•ä¸‹è§£å‹

   ```bash
   cd /tar
   tar -zxvf redis-7.2.4.tar.gz
   ```

4. åŸºæœ¬ç¯å¢ƒï¼šå®‰è£…gccï¼Œæ‰§è¡Œmakeï¼Œæ‰§è¡Œmake instal

5. é»˜è®¤å®‰è£…è·¯å¾„ï¼š`cd /usr/local/bin/`

6. å°†redisé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ï¼ˆrediså®‰è£…ç›®å½•ï¼‰

7. ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œå¯åŠ¨

   **Redisé»˜è®¤ä¸æ˜¯åå°å¯åŠ¨çš„ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼**

   ä¿®æ”¹`daemonize no`ä¸º**yes**

8. é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨redis

   åœ¨redisçš„å®‰è£…ç›®å½•ä¸­ `redis-server cconfig/redis.conf `

   > **æŠ¥é”™**
   >
   > WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.

   > **è§£å†³æ–¹æ¡ˆ**
   >
   > åœ¨/etc/sysctl.confä¸­åŠ å…¥sysctl vm.overcommit_memory=1
   >
   > ç„¶åé‡å¯æœºå™¨oråˆ·æ–°
   >
   > åˆ·æ–°ï¼š
   >
   > /sbin/sysctl -p 
   >
   > /sbin/sysctl -w net.ipv4.route.flush=1

9. å¯åŠ¨rediså®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ `redis-cli -p 6379`

10. å¤åˆ¶æœåŠ¡å™¨ä¼šè¯ï¼ŒæŸ¥çœ‹å·²å¼€å¯çš„redisæœåŠ¡ `ps -ef | grep redis`



# Rediså‘½ä»¤



1. ping : æµ‹è¯•Redisæ˜¯å¦è¿æ¥æˆåŠŸï¼Œè¿æ¥æˆåŠŸè¿”å›PONG

2. set [å‚æ•°å] [å‚æ•°å€¼] ï¼š åˆ›å»ºé”®å€¼å¯¹

3. get [å‚æ•°å] ï¼š æ ¹æ®é”®æŸ¥çœ‹å€¼

4. keys * : æŸ¥çœ‹æ‰€æœ‰å·²å­˜åœ¨çš„å€¼

5. shutdown ï¼š å…³é—­redisæœåŠ¡

6. exit ï¼š é€€å‡º

7. select [åºå·] ï¼š åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“

8. DBSIZE ï¼š æŸ¥çœ‹æ•°æ®åº“å¤§å°

9. flushdb ï¼š æ¸…ç©ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰é”®å€¼å¯¹

10. flushall ï¼š æ¸…ç©ºå…¨éƒ¨æ•°æ®åº“çš„é”®å€¼å¯¹

11. exists [å‚æ•°å] : æŸ¥è¯¢æŸä¸ªå‚æ•°æ˜¯å¦å­˜åœ¨ï¼ˆè¿”å› 1/0 ï¼‰

12. move [å‚æ•°å] [æ•°æ®åº“åºå·] : ç§»åŠ¨å‚æ•°åˆ°æŒ‡å®šæ•°æ®åº“ï¼ˆå¥½åƒå¦‚æœæ˜¯å½“å‰æ•°æ®åº“çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿç§»é™¤æ•ˆæœï¼‰

13. expire [å‚æ•°å] [å¤šå°‘ç§’] : è®¾ç½®æŸä¸ªå‚æ•°å¤šå°‘ç§’è¿‡æœŸ

14. ttl [å‚æ•°å] ï¼š æŸ¥çœ‹å‚æ•°å‰©ä½™è¿‡æœŸæ—¶é—´

15. del [å‚æ•°å] ï¼š åˆ é™¤å‚æ•°

16. type [å‚æ•°å] ï¼š æŸ¥çœ‹å‚æ•°æ•°æ®ç±»å‹

17. **###########   SringğŸ‘‡   #############**

18. append [å‚æ•°å] [å‚æ•°å€¼] ï¼š åœ¨æŒ‡å®šå‚æ•°åé¢åŠ ä¸Šå¯¹åº”å‚æ•°å€¼ï¼ˆå¦‚æœè¯¥å‚æ•°ä¸å­˜åœ¨ï¼Œæ­¤å‘½ä»¤ç­‰äºset keyï¼‰

19. strlen [å‚æ•°å] ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦

20. getrange [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š è·å–å‚æ•°èµ·å§‹ä½ç½®åˆ°ç»“æŸä½ç½®çš„å€¼ï¼ˆ **psï¼š**è·å–ä»å¤´åˆ°å°¾ï¼Œå¯ä»¥è®¾ç½®0,-1ï¼‰

21. setrange [å‚æ•°å] [èµ·å§‹ä½ç½®] [æ›¿æ¢å€¼] : å°†æŒ‡å®šå‚æ•°ï¼Œä»æŒ‡å®šèµ·å§‹ä½ç½®ï¼Œå¼€å§‹æ›¿æ¢ï¼Œæ›¿æ¢ä¸º æŒ‡å®šæ›¿æ¢å€¼

22. **################   åš ++ æ“ä½œï¼ˆæµè§ˆé‡ï¼Œç‚¹å‡»é‡...ï¼‰ ğŸ‘‡ ##################**

23. > set views 0; // åˆ›å»ºæµè§ˆé‡å‚æ•°
    >
    > incr views; // å¼€å§‹++
    >
    > decr views; // å¼€å§‹--
    >
    > incrby views [æ­¥é•¿]; // æ ¹æ®æ­¥é•¿å¼€å§‹++ï¼Œä¾‹å¦‚æ­¥é•¿ä¸º10ï¼Œç›´æ¥+10
    >
    > decrby views [æ­¥é•¿]; // æ ¹æ®æ­¥é•¿å¼€å§‹--ï¼Œä¾‹å¦‚æ­¥é•¿ä¸º10ï¼Œç›´æ¥-10

24.  **######################   ..å…¶ä»–.. ğŸ‘‡  ###########################**

25. setex [å‚æ•°å] [è¿‡æœŸæ—¶é—´] [å‚æ•°å€¼] ï¼š å¸¦ç€å‚æ•°æ—¶é—´å»ºç«‹å‚æ•°

26. **setnx [å‚æ•°å] [å‚æ•°å€¼]** ï¼š **<u>ï¼ˆåœ¨åˆ†å¸ƒå¼é”ä¸­ä¼šå¸¸å¸¸ä½¿ç”¨ï¼ï¼‰</u>**å¦‚æœå‚æ•°åä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¯¹åº”å‚æ•°ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸ç»§ç»­è¿›è¡Œåˆ›å»º

27. mset [å‚æ•°å1] [å‚æ•°å€¼1] [å‚æ•°å2] [å‚æ•°å€¼2] ... ï¼š æ‰¹é‡åˆ›å»ºå‚æ•°

28. mget [å‚æ•°å1] [å‚æ•°å2] [å‚æ•°å3] ... ï¼š æ‰¹é‡è·å–å‚æ•°

29. msetnx [å‚æ•°å1] [å‚æ•°å€¼1] [å‚æ•°å2] [å‚æ•°å€¼2] ... ï¼š æ‰¹é‡åˆ›å»ºå‚æ•°(å¦‚æœå‚æ•°åä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º...)

30. > **ä½¿ç”¨msetåˆ›å»ºjsonæ•°æ®**
    >
    > mset user:1:name zhangsan user:1:age 2
    >
    > mget user:1:name user:1:age
    >
    > **æ ¼å¼ï¼š**user:{id}:{filed}
    >
    > ä¾‹å¦‚ï¼šè®¾ç½®ç¬¬1000ç¯‡æ–‡ç« çš„æµè§ˆé‡
    >
    > set article:1000:views 0;

31. getset [å‚æ•°å] [å‚æ•°å€¼] ï¼š å…ˆè·å–ï¼Œå†åˆ›å»º

    > ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„å‚æ•°ï¼Œä½¿ç”¨ getset db redis;
    >
    > ä¼šè¿”å›ä¸€ä¸ª (nil) ä¸å­˜åœ¨ï¼Œä½†æ˜¯å·²ç»åˆ›å»ºå¥½äº†dbå‚æ•°
    >
    > æ­¤æ—¶ï¼Œå†æ¬¡ä½¿ç”¨ getset db mongodb
    >
    > å°†è¿”å› redisï¼Œå¹¶è¦†ç›–ä¸ºmongodb

32. **################   List ğŸ‘‡   ##################**

33. LPUSH/RPUSH [å‚æ•°å] [å‚æ•°å€¼] : å¯ä»¥ä¸æ–­å¾€åŒä¸€ä¸ªå‚æ•°åä¸­æ”¾å…¥å€¼ï¼ˆLä»£è¡¨çš„æ˜¯ä»å·¦è¾¹å¼€å§‹æ”¾å€¼ï¼ŒRæ˜¯ä»å³è¾¹å¼€å§‹æ”¾å€¼ï¼‰

34. LRANGE [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š æŸ¥è¯¢listï¼Œå¦‚æœæŸ¥è¯¢å…¨éƒ¨ï¼Œç›´æ¥ `LRANGE xxx 0 -1`

35. LPOP/RPOP [å‚æ•°å] ï¼š ç§»é™¤ä¸€ä¸ªå€¼ï¼ˆ L / R å·¦æˆ–å³ ï¼‰

36. LINDEX [å‚æ•°å] [ä¸‹æ ‡] ï¼š é€šè¿‡ä¸‹æ ‡è·å–å€¼

37. LLEN [å‚æ•°å] ï¼š è¿”å›åˆ—è¡¨çš„é•¿åº¦

38. LREM [å‚æ•°å] [COUNT] [å‚æ•°å€¼] ï¼š ç§»é™¤æŒ‡å®šå‚æ•°ä¸­çš„æŒ‡å®šå€¼ï¼Œç§»é™¤COUNTä¸ª

39. LTRIM [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š åªç•™ä¸‹æŒ‡å®šä½ç½®åˆ°æŒ‡å®šä½ç½®çš„å†…å®¹

40. RPOPLPUSH [å‚æ•°1] [å‚æ•°2] ï¼š ç§»é™¤å‚æ•°1çš„æœ€åä¸€ä¸ªå€¼ï¼Œå¹¶æ’å…¥åˆ°å‚æ•°2ï¼ˆè¢«ç§»é™¤çš„å€¼æ’å…¥åˆ°å‚æ•°2ï¼‰ 

41. LSET [å‚æ•°å] [ä¸‹æ ‡] [å‚æ•°å€¼] ï¼š å°†æŒ‡å®šå‚æ•°çš„ï¼ŒæŒ‡å®šä¸‹æ ‡çš„å†…å®¹æ›¿æ¢ä¸ºæ–°çš„å‚æ•°å€¼

42. LINSERT [å‚æ•°å] [ä½ç½®ï¼ˆbefore/afterï¼‰] [å“ªä¸ªå€¼] [å‚æ•°å€¼] ï¼š åœ¨æŒ‡å®š**å‚æ•°å**çš„**before/after**çš„ä½ç½®ï¼Œ**æŒ‡å®šæŸä¸ªå€¼**æ·»åŠ **å‚æ•°å€¼**

43. **################   Hash   ğŸ‘‡ ################**

44. HSET [å‚æ•°å] [key] [value] ï¼š åˆ›å»ºå‚æ•°ï¼Œå€¼ä¸º <u>Mapé”®å€¼å¯¹</u>

45. HGET [å‚æ•°å] [key] ï¼š æŒ‡å®šå‚æ•°åï¼Œè·å–æŒ‡å®škeyçš„value

46. HMSET [å‚æ•°å] [key1] [value1] [key2] [value2] [key3] [value3] : æ‰¹é‡åˆ›å»ºMapé”®å€¼å¯¹

47. HMGET [å‚æ•°å] [key1] [key2] ï¼š æ‰¹é‡è·å–æŒ‡å®škeyçš„value

    > Redis4.0å¼€å§‹ï¼Œå¼ƒç”¨HMSETï¼Œç›´æ¥ä½¿ç”¨HSETä¹Ÿå¯ä»¥æ‰¹é‡åˆ›å»º

48. HGETALL [å‚æ•°å] ï¼š è·å–ä¸€ä¸ªæŒ‡å®šå‚æ•°ä¸­çš„**æ‰€æœ‰é”®å€¼å¯¹**

    > **é¡ºç€ä»¥**
    >
    > key1
    >
    > value1
    >
    > key2
    >
    > value2
    >
    > **æ˜¾ç¤º**

49. HDEL [å‚æ•°å] [key1] [key2] ï¼š åˆ é™¤æŒ‡å®šå‚æ•°çš„æŒ‡å®škey

50. HLEN [å‚æ•°å] : æŸ¥çœ‹key-valueä¸ªæ•°

51. HEXISTS [å‚æ•°å] [key] ï¼š åˆ¤æ–­æŒ‡å®šå‚æ•°åä¸­çš„æŒ‡å®škeyæ˜¯å¦å­˜åœ¨

52. HKEYS [å‚æ•°å] ï¼š è·å–æŒ‡å®šå‚æ•°åä¸­çš„**æ‰€æœ‰key**

53. HVALS [å‚æ•°å] ï¼š è·å–æŒ‡å®šå‚æ•°åä¸­çš„**æ‰€æœ‰value**

54. HINCRBY [å‚æ•°å] [key] [æ•°å€¼] ï¼š ç»™æŒ‡å®šå‚æ•°åçš„ æŒ‡å®škey çš„value å¢åŠ æˆ–å‡å°‘ ä¸€ä¸ªå€¼

55. HSETNX [å‚æ•°å] [key] [value] ï¼š ä¸å­˜åœ¨åˆ™æ·»åŠ æˆåŠŸï¼Œå­˜åœ¨åˆ™æ·»åŠ å¤±è´¥

56. **#######################   Zser  ğŸ‘‡ #########################**

57. zadd [å‚æ•°å] [åºå·ä½ç½®] [å‚æ•°å€¼] ï¼š ç»™æŒ‡å®šå‚æ•°æ·»åŠ æŒ‡å®šå‚æ•°å€¼ï¼Œå¹¶é…ä¸Šå…¶åºå·ä½ç½®ï¼Œä½œä¸ºæ’åºä¾æ®ã€è¿™ä¸ªæ’åºä¾æ®ï¼Œç§°ä¸ºScoreã€‘

58. zrange [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š æŸ¥çœ‹æœ‰åºé›†åˆ

    **PSï¼š**è¿˜æœ‰ZREVRANGE

59. zrangebyscore [å‚æ•°å] [min] [max] ï¼š å°†æŒ‡å®šå‚æ•°åï¼Œé€šè¿‡SCOREï¼Œè¿›è¡ŒèŒƒå›´æŸ¥çœ‹ï¼Œä»æŒ‡å®šçš„minå€¼ï¼Œåˆ°æŒ‡å®šçš„maxå€¼æŸ¥çœ‹

    **PS**ï¼šä½¿ç”¨ZREVRANGEBYSCOREï¼Œå¯ä»¥ä»maxåˆ°minè¿›è¡ŒæŸ¥çœ‹ã€é€†åºã€‘  

    > **ä¾‹å¦‚**
    >
    > ZRANGEBYSCORE xxx -inf +inf	ï¼šè¡¨ç¤ºä»è´Ÿæ— ç©·åˆ°æ­£æ— ç©·æ’åºï¼Œå°±æ˜¯ä»å°åˆ°å¤§æ’åº
    >
    > ZRANGEBYSCORE xxx -inf 2500	ï¼šè¡¨ç¤ºä»è´Ÿæ— ç©·åˆ°æœ€å¤§2500æ’åº

60. zrangebyscore [å‚æ•°å] [min] [max] WITHSCORES ï¼š å¦‚ä¸Šï¼Œä¼šå¸¦ä¸ŠSCOREå†…å®¹

    > **æŸ¥è¯¢ç»“æœï¼Œå¦‚ä¸‹ï¼š**
    >
    > "value1"
    >
    > "score1"
    >
    > "value2"
    >
    > "score2"
    >
    > ...

61. ZCARD [å‚æ•°å] ï¼š æŸ¥çœ‹æŒ‡å®šå‚æ•°åçš„å…ƒç´ ä¸ªæ•° 

62. ZCOUNT [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š è·å–èµ·å§‹ä½ç½®åˆ°ç»“æŸä½ç½®ä¸­é—´å€¼çš„ä¸ªæ•° 













# æµ‹è¯•æ€§èƒ½

`redis-benchmark`ï¼šå‹åŠ›æµ‹è¯•å·¥å…·

å®˜æ–¹è‡ªå¸¦çš„æ€§èƒ½æµ‹è¯•å·¥å…·

| åºå· | é€‰é¡¹               | æè¿°                                       | é»˜è®¤å€¼    |
| ---- | ------------------ | ------------------------------------------ | --------- |
| 1    | -h                 | æŒ‡å®šæœåŠ¡å™¨ä¸»æœºå                           | 127.0.0.1 |
| 2    | -p                 | æŒ‡å®šæœåŠ¡å™¨ç«¯å£                             | 6379      |
| 3    | -s                 | æŒ‡å®šæœåŠ¡å™¨ socket                          |           |
| 4    | -c                 | æŒ‡å®šå¹¶å‘è¿æ¥æ•°                             | 50        |
| 5    | -n                 | æŒ‡å®šè¯·æ±‚æ•°                                 | 10000     |
| 6    | -d                 | ä»¥å­—èŠ‚çš„å½¢å¼æŒ‡å®š SET/GET å€¼çš„æ•°æ®å¤§å°      | 2         |
| 7    | -k                 | 1=keep alive 0=reconnect                   | 1         |
| 8    | -r                 | SET/GET/INCR ä½¿ç”¨éšæœº key, SADD ä½¿ç”¨éšæœºå€¼ |           |
| 9    | -P                 | é€šè¿‡ç®¡é“ä¼ è¾“ <numreq> è¯·æ±‚                 | 1         |
| 10   | -q                 | å¼ºåˆ¶é€€å‡º redisã€‚ä»…æ˜¾ç¤º query/sec å€¼        |           |
| 11   | --csv              | ä»¥ CSV æ ¼å¼è¾“å‡º                            |           |
| 12   | -lï¼ˆL çš„å°å†™å­—æ¯ï¼‰ | ç”Ÿæˆå¾ªç¯ï¼Œæ°¸ä¹…æ‰§è¡Œæµ‹è¯•                     |           |
| 13   | -t                 | ä»…è¿è¡Œä»¥é€—å·åˆ†éš”çš„æµ‹è¯•å‘½ä»¤åˆ—è¡¨ã€‚           |           |
| 14   | -Iï¼ˆi çš„å¤§å†™å­—æ¯ï¼‰ | Idle æ¨¡å¼ã€‚ä»…æ‰“å¼€ N ä¸ª idle è¿æ¥å¹¶ç­‰å¾…ã€‚   |           |

**ä¾‹å¦‚ï¼š**æµ‹è¯• 100ä¸ªå¹¶å‘è¿æ¥ ï¼Œ 100000ä¸ªè¯·æ±‚

`redis-benchmark -h localhost -p 6379 -c 100 -n 100000`

æµ‹è¯•ç»“æœå­—æ®µè§£é‡Š â€”â€” SETéƒ¨åˆ†ï¼š

> ====== SET ======                          
>
>  100000 requests completed in 0.82 seconds
>
>  100 parallel clients	ï¼š	**100ä¸ªå¹¶å‘å®¢æˆ·ç«¯**
>
>  3 bytes payload	ï¼š	**æ¯æ¬¡å†™å…¥3ä¸ªå­—èŠ‚**
>
>  keep alive: 1	ï¼š	**åªæœ‰ä¸€å°æœåŠ¡å™¨æ¥å¤„ç†è¿™äº›è¯·æ±‚ï¼Œå•æœºæ€§èƒ½**
>
>  host configuration "save": 3600 1 300 100 60 10000
>
>  host configuration "appendonly": no
>
>  multi-thread: no
>
> throughput summary: 140845.08 requests per second	ï¼š	**æ¯ç§’å¤„ç†140845.08ä¸ªè¯·æ±‚**
>



# åŸºç¡€çŸ¥è¯†

é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œåœ¨redis.confä¸­

`databases 16`

é»˜è®¤ä½¿ç”¨ç¬¬0ä¸ªï¼Œå¯ä»¥æ˜¯ç”¨selectè¿›è¡Œåˆ‡æ¢æ•°æ®åº“ï¼ˆè§Rediså‘½ä»¤ç¬¬6ä¸ªï¼‰









# äº”å¤§æ•°æ®ç±»å‹

> - Redis-Key
> - String
> - List
> - Setï¼ˆé›†åˆï¼‰
> - Hashï¼ˆæ•£åˆ—ï¼‰
> - Zset

## String

**å¸¸ç”¨å¦‚ä¸‹**

1. append [å‚æ•°å] [å‚æ•°å€¼] ï¼š åœ¨æŒ‡å®šå‚æ•°åé¢åŠ ä¸Šå¯¹åº”å‚æ•°å€¼ï¼ˆå¦‚æœè¯¥å‚æ•°ä¸å­˜åœ¨ï¼Œæ­¤å‘½ä»¤ç­‰äºset keyï¼‰

2. strlen [å‚æ•°å] ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦

3. getrange [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š è·å–å‚æ•°èµ·å§‹ä½ç½®åˆ°ç»“æŸä½ç½®çš„å€¼ï¼ˆ **psï¼š**è·å–ä»å¤´åˆ°å°¾ï¼Œå¯ä»¥è®¾ç½®0,-1ï¼‰

4. setrange [å‚æ•°å] [èµ·å§‹ä½ç½®] [æ›¿æ¢å€¼] : å°†æŒ‡å®šå‚æ•°ï¼Œä»æŒ‡å®šèµ·å§‹ä½ç½®ï¼Œå¼€å§‹æ›¿æ¢ï¼Œæ›¿æ¢ä¸º æŒ‡å®šæ›¿æ¢å€¼

5. > set views 0; // åˆ›å»ºæµè§ˆé‡å‚æ•°
   >
   > incr views; // å¼€å§‹++
   >
   > decr views; // å¼€å§‹--
   >
   > incrby views [æ­¥é•¿]; // æ ¹æ®æ­¥é•¿å¼€å§‹++ï¼Œä¾‹å¦‚æ­¥é•¿ä¸º10ï¼Œç›´æ¥+10
   >
   > decrby views [æ­¥é•¿]; // æ ¹æ®æ­¥é•¿å¼€å§‹--ï¼Œä¾‹å¦‚æ­¥é•¿ä¸º10ï¼Œç›´æ¥-10

6. setex [å‚æ•°å] [è¿‡æœŸæ—¶é—´] [å‚æ•°å€¼] ï¼š å¸¦ç€å‚æ•°æ—¶é—´å»ºç«‹å‚æ•°

7. **setnx [å‚æ•°å] [å‚æ•°å€¼]** ï¼š **<u>ï¼ˆåœ¨åˆ†å¸ƒå¼é”ä¸­ä¼šå¸¸å¸¸ä½¿ç”¨ï¼ï¼‰</u>**å¦‚æœå‚æ•°åä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¯¹åº”å‚æ•°ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸ç»§ç»­è¿›è¡Œåˆ›å»º

8. mset [å‚æ•°å1] [å‚æ•°å€¼1] [å‚æ•°å2] [å‚æ•°å€¼2] ... ï¼š æ‰¹é‡åˆ›å»ºå‚æ•°

9. mget [å‚æ•°å1] [å‚æ•°å2] [å‚æ•°å3] ... ï¼š æ‰¹é‡è·å–å‚æ•°

10. msetnx [å‚æ•°å1] [å‚æ•°å€¼1] [å‚æ•°å2] [å‚æ•°å€¼2] ... ï¼š æ‰¹é‡åˆ›å»ºå‚æ•°(å¦‚æœå‚æ•°åä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º...)

11. > **ä½¿ç”¨msetåˆ›å»ºjsonæ•°æ®**
    >
    > mset user:1:name zhangsan user:1:age 2
    >
    > mget user:1:name user:1:age
    >
    > **æ ¼å¼ï¼š**user:{id}:{filed}
    >
    > ä¾‹å¦‚ï¼šè®¾ç½®ç¬¬1000ç¯‡æ–‡ç« çš„æµè§ˆé‡
    >
    > set article:1000:views 0;

12. getset [å‚æ•°å] [å‚æ•°å€¼] ï¼š å…ˆè·å–ï¼Œå†åˆ›å»º

    > ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„å‚æ•°ï¼Œä½¿ç”¨ getset db redis;
    >
    > ä¼šè¿”å›ä¸€ä¸ª (nil) ä¸å­˜åœ¨ï¼Œä½†æ˜¯å·²ç»åˆ›å»ºå¥½äº†dbå‚æ•°
    >
    > æ­¤æ—¶ï¼Œå†æ¬¡ä½¿ç”¨ getset db mongodb
    >
    > å°†è¿”å› redisï¼Œå¹¶è¦†ç›–ä¸ºmongodb







## List

listå¯ä»¥ç©æˆ æ ˆã€é˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—ï¼

æ ˆï¼šå…ˆè¿›åå‡º

é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡º

é˜»å¡é˜Ÿåˆ—ï¼šä¸¤è¾¹éƒ½å¼€ï¼Ÿ

**æ‰€æœ‰çš„listå‘½ä»¤éƒ½æ˜¯ä»¥lå¼€å¤´**

1. LPUSH/RPUSH [å‚æ•°å] [å‚æ•°å€¼] : å¯ä»¥ä¸æ–­å¾€åŒä¸€ä¸ªå‚æ•°åä¸­æ”¾å…¥å€¼ï¼ˆLä»£è¡¨çš„æ˜¯ä»å·¦è¾¹å¼€å§‹æ”¾å€¼ï¼ŒRæ˜¯ä»å³è¾¹å¼€å§‹æ”¾å€¼ï¼‰
2. LRANGE [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š æŸ¥è¯¢listï¼Œå¦‚æœæŸ¥è¯¢å…¨éƒ¨ï¼Œç›´æ¥ `LRANGE xxx 0 -1`
3. LPOP/RPOP [å‚æ•°å] ï¼š ç§»é™¤ä¸€ä¸ªå€¼ï¼ˆ L / R å·¦æˆ–å³ ï¼‰
4. LINDEX [å‚æ•°å] [ä¸‹æ ‡] ï¼š é€šè¿‡ä¸‹æ ‡è·å–å€¼
5. LLEN [å‚æ•°å] ï¼š è¿”å›åˆ—è¡¨çš„é•¿åº¦
6. LREM [å‚æ•°å] [COUNT] [å‚æ•°å€¼] ï¼š ç§»é™¤æŒ‡å®šå‚æ•°ä¸­çš„æŒ‡å®šå€¼ï¼Œç§»é™¤COUNTä¸ª
7. LTRIM [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š åªç•™ä¸‹æŒ‡å®šä½ç½®åˆ°æŒ‡å®šä½ç½®çš„å†…å®¹
8. RPOPLPUSH [å‚æ•°1] [å‚æ•°2] ï¼š ç§»é™¤å‚æ•°1çš„æœ€åä¸€ä¸ªå€¼ï¼Œå¹¶æ’å…¥åˆ°å‚æ•°2ï¼ˆè¢«ç§»é™¤çš„å€¼æ’å…¥åˆ°å‚æ•°2ï¼‰ 
9. LSET [å‚æ•°å] [ä¸‹æ ‡] [å‚æ•°å€¼] ï¼š å°†æŒ‡å®šå‚æ•°çš„ï¼ŒæŒ‡å®šä¸‹æ ‡çš„å†…å®¹æ›¿æ¢ä¸ºæ–°çš„å‚æ•°å€¼
10. LINSERT [å‚æ•°å] [ä½ç½®ï¼ˆbefore/afterï¼‰] [å“ªä¸ªå€¼] [å‚æ•°å€¼] ï¼š åœ¨æŒ‡å®š**å‚æ•°å**çš„**before/after**çš„ä½ç½®ï¼Œ**æŒ‡å®šæŸä¸ªå€¼**æ·»åŠ **å‚æ•°å€¼**







## Setï¼ˆé›†åˆï¼‰

setä¸­çš„å€¼ä¸èƒ½é‡å¤ï¼

1. SADD [å‚æ•°å] [å‚æ•°å€¼] : æ·»åŠ é›†åˆå…ƒç´ 
2. SMEMBERS [å‚æ•°å] : æŸ¥çœ‹é›†åˆå…ƒç´ 
3. SISMEMBER [å‚æ•°å] [å‚æ•°å€¼] ï¼š æŸ¥çœ‹æŒ‡å®šå‚æ•°åï¼Œæ˜¯å¦å­˜åœ¨æŒ‡å®šå‚æ•°ï¼Œè¿”å› 1 / 0
4. SCARD [å‚æ•°å] ï¼š æŸ¥çœ‹é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°
5. SREM [å‚æ•°å] [å‚æ•°å€¼] ï¼š ç§»é™¤æŒ‡å®šå‚æ•°åä¸­çš„æŒ‡å®šå‚æ•°å€¼
6. SRANDMEMBER [å‚æ•°å] [ä¸ªæ•°]ï¼š ä»æŒ‡å®šå‚æ•°åä¸­å–å‡ºéšæœºå‚æ•°å€¼ï¼Œå¯ä»¥ä¸å†™æ•°é‡å€¼ï¼Œé»˜è®¤ä¸€ä¸ª
7. SPOP [å‚æ•°å] ï¼š ä»æŒ‡å®šå‚æ•°åçš„é›†åˆä¸­éšæœºå–å‡ºå…ƒç´ 
8. SMOVE [å‚æ•°å1] [å‚æ•°å2] [å‚æ•°å€¼] ï¼š å°†æŒ‡å®šå‚æ•°å1å†…çš„æŒ‡å®šå‚æ•°å€¼ï¼Œç§»åŠ¨åˆ°å‚æ•°å2
9. SDIFF [å‚æ•°å1] [å‚æ•°å2] ï¼š æŸ¥çœ‹å‚æ•°å1ä¸­ï¼Œå‚æ•°å2æ²¡æœ‰çš„å…ƒç´ ï¼ˆå·®é›†ï¼‰
10. SINTER [å‚æ•°å1] [å‚æ•°å2] ï¼š æŸ¥çœ‹å‚æ•°å1å’Œå‚æ•°å2ä¸­çš„å…±åŒå…ƒç´ ï¼ˆäº¤é›†ï¼‰ï¼ˆå…±åŒå¥½å‹ï¼‰
11. SUNION [å‚æ•°å1] [å‚æ•°å2] ï¼š æŸ¥çœ‹å‚æ•°å1å’Œå‚æ•°å2åŠ èµ·æ¥çš„æ‰€æœ‰å…ƒç´ ã€å»é‡ã€‘ï¼ˆå¹¶é›†ï¼‰





## Hashï¼ˆå“ˆå¸Œï¼‰

1. HSET [å‚æ•°å] [key] [value] ï¼š åˆ›å»ºå‚æ•°ï¼Œå€¼ä¸º <u>Mapé”®å€¼å¯¹</u>

2. HGET [å‚æ•°å] [key] ï¼š æŒ‡å®šå‚æ•°åï¼Œè·å–æŒ‡å®škeyçš„value

3. HMSET [å‚æ•°å] [key1] [value1] [key2] [value2] [key3] [value3] : æ‰¹é‡åˆ›å»ºMapé”®å€¼å¯¹

4. HMGET [å‚æ•°å] [key1] [key2] ï¼š æ‰¹é‡è·å–æŒ‡å®škeyçš„value

   > Redis4.0å¼€å§‹ï¼Œå¼ƒç”¨HMSETï¼Œç›´æ¥ä½¿ç”¨HSETä¹Ÿå¯ä»¥æ‰¹é‡åˆ›å»º

5. HGETALL [å‚æ•°å] ï¼š è·å–ä¸€ä¸ªæŒ‡å®šå‚æ•°ä¸­çš„**æ‰€æœ‰é”®å€¼å¯¹**

   > **é¡ºç€ä»¥**
   >
   > key1
   >
   > value1
   >
   > key2
   >
   > value2
   >
   > **æ˜¾ç¤º**

6. HDEL [å‚æ•°å] [key1] [key2] ï¼š åˆ é™¤æŒ‡å®šå‚æ•°çš„æŒ‡å®škey

7. HLEN [å‚æ•°å] : æŸ¥çœ‹key-valueä¸ªæ•°

8. HEXISTS [å‚æ•°å] [key] ï¼š åˆ¤æ–­æŒ‡å®šå‚æ•°åä¸­çš„æŒ‡å®škeyæ˜¯å¦å­˜åœ¨

9. HKEYS [å‚æ•°å] ï¼š è·å–æŒ‡å®šå‚æ•°åä¸­çš„**æ‰€æœ‰key**

10. HVALS [å‚æ•°å] ï¼š è·å–æŒ‡å®šå‚æ•°åä¸­çš„**æ‰€æœ‰value**

11. HINCRBY [å‚æ•°å] [key] [æ•°å€¼] ï¼š ç»™æŒ‡å®šå‚æ•°åçš„ æŒ‡å®škey çš„value å¢åŠ æˆ–å‡å°‘ ä¸€ä¸ªå€¼

12. HSETNX [å‚æ•°å] [key] [value] ï¼š ä¸å­˜åœ¨åˆ™æ·»åŠ æˆåŠŸï¼Œå­˜åœ¨åˆ™æ·»åŠ å¤±è´¥

 





## Zsetï¼ˆæœ‰åºé›†åˆï¼‰

1. zadd [å‚æ•°å] [åºå·ä½ç½®] [å‚æ•°å€¼] ï¼š ç»™æŒ‡å®šå‚æ•°æ·»åŠ æŒ‡å®šå‚æ•°å€¼ï¼Œå¹¶é…ä¸Šå…¶åºå·ä½ç½®ï¼Œä½œä¸ºæ’åºä¾æ®ã€è¿™ä¸ªæ’åºä¾æ®ï¼Œç§°ä¸ºScoreã€‘

2. zrange [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š æŸ¥çœ‹æœ‰åºé›†åˆ

   **PSï¼š**è¿˜æœ‰ZREVRANGE

3. zrangebyscore [å‚æ•°å] [min] [max] ï¼š å°†æŒ‡å®šå‚æ•°åï¼Œé€šè¿‡SCOREï¼Œè¿›è¡ŒèŒƒå›´æŸ¥çœ‹ï¼Œä»æŒ‡å®šçš„minå€¼ï¼Œåˆ°æŒ‡å®šçš„maxå€¼æŸ¥çœ‹

   **PS**ï¼šä½¿ç”¨ZREVRANGEBYSCOREï¼Œå¯ä»¥ä»maxåˆ°minè¿›è¡ŒæŸ¥çœ‹ã€é€†åºã€‘  

   > **ä¾‹å¦‚**
   >
   > ZRANGEBYSCORE xxx -inf +inf	ï¼šè¡¨ç¤ºä»è´Ÿæ— ç©·åˆ°æ­£æ— ç©·æ’åºï¼Œå°±æ˜¯ä»å°åˆ°å¤§æ’åº
   >
   > ZRANGEBYSCORE xxx -inf 2500	ï¼šè¡¨ç¤ºä»è´Ÿæ— ç©·åˆ°æœ€å¤§2500æ’åº

4. zrangebyscore [å‚æ•°å] [min] [max] WITHSCORES ï¼š å¦‚ä¸Šï¼Œä¼šå¸¦ä¸ŠSCOREå†…å®¹

   > **æŸ¥è¯¢ç»“æœï¼Œå¦‚ä¸‹ï¼š**
   >
   > "value1"
   >
   > "score1"
   >
   > "value2"
   >
   > "score2"
   >
   > ...

5. ZCARD [å‚æ•°å] ï¼š æŸ¥çœ‹æŒ‡å®šå‚æ•°åçš„å…ƒç´ ä¸ªæ•° 

6. ZCOUNT [å‚æ•°å] [èµ·å§‹ä½ç½®] [ç»“æŸä½ç½®] ï¼š è·å–èµ·å§‹ä½ç½®åˆ°ç»“æŸä½ç½®ä¸­é—´å€¼çš„ä¸ªæ•° 







# ä¸‰ç§ç‰¹æ®Šæ•°æ®ç±»å‹



> - geospatial
> - hyperloglog
> - bitmaps

## geospatialåœ°ç†ä½ç½®

> Redisçš„Geoé˜¿ç´«Redis3.2æ¨å‡ºï¼Œå¯ä»¥æ¨ç®—åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Œæ–¹åœ†å‡ é‡Œçš„äºº

### GEOADD

æ·»åŠ åœ°ç†ä½ç½®

> **è§„åˆ™ï¼š**åœ°çƒä¸¤ææ— æ³•ç›´æ¥æ·»åŠ 
>
> ä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚çš„æ•°æ®ï¼Œé€šè¿‡Javaç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥

**æ ¼å¼ï¼š**`geoadd [å‚æ•°1]:[å‚æ•°2] [ç»åº¦] [çº¬åº¦] [åŸå¸‚å]`

> **ä¾‹å¦‚ï¼š** geoadd china:city 121.47 31.23 shanghai
>
> **è¡¨ç¤ºï¼š** æ·»åŠ  **ä¸­å›½:åŸå¸‚ / ç»çº¬åº¦ / ä¸Šæµ·**

ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªï¼

`geoadd china:city 121.47 31.23 shanghai 116.41 39.90 beijing`



### GEOPOS

æŸ¥è¯¢åœ°ç†ä½ç½®

**æ ¼å¼ï¼š**`GEOPOS [å‚æ•°1]:[å‚æ•°2] [åŸå¸‚å]`

> **ä¾‹å¦‚ï¼š**GEOPOS china:city beijing
>
> **è¡¨ç¤ºï¼š**æŸ¥è¯¢**åŒ—äº¬**çš„ç»çº¬åº¦åæ ‡

ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§è·å–å¤šä¸ªï¼

`GEOPOS china:city beijing wuhan`



### GEODIST

è¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»

> **å•ä½ï¼š**
>
> - mï¼šç±³
> - kmï¼šåƒç±³
> - miï¼šè‹±é‡Œ
> - ftï¼šè‹±å°º

**æ ¼å¼ï¼š**`GEODIST [å‚æ•°1]:[å‚æ•°2] [ä½ç½®1] [ä½ç½®2] [å•ä½]`

> **ä¾‹å¦‚ï¼š**GEODIST china:city beijing shanghai KM
>
> **è¡¨ç¤ºï¼š**è®¡ç®—åŒ—äº¬å’Œä¸Šæµ·çš„ç›´çº¿è·ç¦»ï¼Œå•ä½km



### GEORADIUS

ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„çš„å…ƒç´ 

**æ ¼å¼ï¼š**`GEORADIUS [å‚æ•°1]:[å‚æ•°2] [ç»åº¦] [çº¬åº¦] [è·ç¦»] [å•ä½]`

> **ä¾‹å­ï¼š**GEORADIUS china:city 116.41 39.9 10000 km
>
> **è¡¨ç¤ºï¼š**æŸ¥è¯¢116.41 39.9 ï¼Œå‘¨å›´10000kmä»¥å†…çš„åœ°ç‚¹ï¼ˆä»china:cityï¼‰ä¸­

> **åŠ åœ¨æœ«å°¾çš„å…¶ä»–å‚æ•°ï¼Œè¿”å›é™„åŠ ä¿¡æ¯ï¼š**
>
> - `WITHDIST`ï¼šä¹Ÿè¿”å›ä»æŒ‡å®šä¸­å¿ƒç‚¹è¿”å›çš„é¡¹ç›®çš„è·ç¦»ã€‚è·ç¦»ä»¥ä¸å‘½ä»¤çš„åŠå¾„å‚æ•°æŒ‡å®šçš„å•ä½ç›¸åŒçš„å•ä½è¿”å›ã€‚
>
> - `WITHCOORD`: ä¹Ÿè¿”å›åŒ¹é…é¡¹ç›®çš„ç»åº¦å’Œçº¬åº¦åæ ‡ã€‚
>
> - `WITHHASH`ï¼šä¹Ÿè¿”å›é¡¹ç›®çš„åŸå§‹åœ°ç†å“ˆå¸Œç¼–ç æ’åºé›†åˆ†æ•°ï¼Œä»¥52ä½æ— ç¬¦å·æ•´æ•°çš„å½¢å¼è¿”å›ã€‚è¿™ä»…å¯¹ä½çº§åˆ«çš„é»‘å®¢æˆ–è°ƒè¯•æœ‰ç”¨ï¼Œå¯¹æ™®é€šç”¨æˆ·æ¥è¯´æ²¡æœ‰å¤ªå¤§å…´è¶£ã€‚
>
>   
>
> **é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘½ä»¤å°†è¿”å›æœªæ’åºçš„é¡¹ç›®ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹è°ƒç”¨ä¸¤ç§ä¸åŒçš„æ’åºæ–¹æ³•ï¼š**
>
> - `ASC`ï¼šæ ¹æ®ä¸ä¸­å¿ƒç‚¹çš„è·ç¦»ï¼Œå°†è¿”å›çš„é¡¹ç›®ä»æœ€è¿‘åˆ°æœ€è¿œæ’åºã€‚
> - `DESC`ï¼šæ ¹æ®ä¸ä¸­å¿ƒç‚¹çš„è·ç¦»ï¼Œå°†è¿”å›çš„é¡¹ç›®ä»æœ€è¿œåˆ°æœ€è¿‘æ’åºã€‚
>
> é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†è¿”å›æ‰€æœ‰åŒ¹é…çš„é¡¹ç›®ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ **COUNT `<count>`** é€‰é¡¹å°†ç»“æœé™åˆ¶ä¸ºå‰Nä¸ªåŒ¹é…çš„é¡¹ç›®ã€‚ å½“æä¾›äº† `ANY` æ—¶ï¼Œå‘½ä»¤ä¼šåœ¨æ‰¾åˆ°è¶³å¤Ÿçš„åŒ¹é…é¡¹åç«‹å³è¿”å›ï¼Œ å› æ­¤ç»“æœå¯èƒ½ä¸æ˜¯ç¦»æŒ‡å®šç‚¹æœ€è¿‘çš„ç»“æœï¼Œä½†æ˜¯æœåŠ¡å™¨çš„æŠ•å…¥é‡æ˜¾è‘—è¾ƒä½ã€‚ å½“æœªæä¾› `ANY` æ—¶ï¼Œå‘½ä»¤å°†æ ¹æ®ä¸æŒ‡å®šåŒºåŸŸåŒ¹é…çš„é¡¹ç›®æ•°é‡è¿›è¡Œæ’åºå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œ å› æ­¤ï¼Œå³ä½¿åªè¿”å›äº†å°‘é‡ç»“æœï¼Œåœ¨æŸ¥è¯¢éå¸¸å¤§çš„åŒºåŸŸå’Œéå¸¸å°çš„ `COUNT` é€‰é¡¹æ—¶å¯èƒ½ä¼šå¾ˆæ…¢ã€‚



### GEORADIUSBYMEMBER

æ ¹æ®å·²æœ‰å…ƒç´ ï¼ŒæŸ¥è¯¢å…¶å‘¨å›´å…ƒç´ 

æ ¼å¼ï¼š`GEORADIUSBYMEMBER [å‚æ•°1]:[å‚æ•°2] [åŸå¸‚å] [è·ç¦»] [å•ä½]`

> **ä¾‹å­ï¼š**GEORADIUSBYMEMBER china:city beijing 10000 km
>
> **è¡¨ç¤ºï¼š**æŸ¥è¯¢åŒ—äº¬å‘¨å›´10000kmçš„å…ƒç´ 





### GEOHASH

è¿”å›æŒ‡å®šå…ƒç´ çš„Geohashå­—ç¬¦ä¸²

**æ ¼å¼ï¼š**`GEOHASH [å‚æ•°1]:[å‚æ•°2] [åŸå¸‚å1] [åŸå¸‚å2]`

> **ä¾‹å­ï¼š**GEOHASH china:city beijing shanghai
>
> **è¡¨ç¤ºï¼š**è¿”å›åŒ—äº¬å’Œä¸Šæµ·çš„geohashå­—ç¬¦ä¸²ï¼Œç»“æœå¦‚ä¸‹ ğŸ‘‡
>
> 1) "wx4fbzx4me0"
> 2) "wtw3sj5zbj0"



### æ³¨æ„

GEOåº•å±‚å®ç°åŸç†å°±æ˜¯Zsetï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨Zsetæ¥æ“ä½œGeo



## Hyperloglog

> ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ

A{1,3,5,7,8,7}

B{1,3,5,7,8}

åŸºæ•°ï¼Œå³ä¸€ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ 

ä¸Šé¢çš„åŸºæ•° = 5



### ç®€ä»‹

[HyperLogLog | Redis ä¸­æ–‡ç½‘ (redisdocs.com)](https://www.redisdocs.com/zh-cn/docs/data-types/probabilistic/hyperloglogs/)

åŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼Œæœ‰0.81%çš„å®¹é”™ï¼Œå…è®¸å®¹é”™çš„åœºæ™¯å¯ä»¥ä½¿ç”¨ï¼

HyperLogLogæ˜¯ä¸€ç§æ¦‚ç‡æ•°æ®ç»“æ„ï¼Œç”¨äºä¼°ç®—ä¸€ä¸ªé›†åˆçš„åŸºæ•°ã€‚



**åº”ç”¨åœºæ™¯ï¼š**ç½‘é¡µUVï¼ˆä¸€ä¸ªäººè®¿é—®ä¸€ä¸ªç½‘ç«™å¤šæ¬¡ï¼Œä½†æ˜¯ä¾æ—§ç®—ä½œä¸€ä¸ªäººï¼‰

> **ä¼ ç»Ÿçš„æ–¹å¼ï¼š**setä¿å­˜ç”¨æˆ·çš„idï¼Œsetå­˜å‚¨çš„æ˜¯ä¸é‡å¤å…ƒç´ ï¼Œç»Ÿè®¡setä¸­çš„å…ƒç´ æ•°é‡ä½œä¸ºåˆ¤æ–­æ ‡å‡†
>
> **ç¼ºç‚¹ï¼š**ä¿å­˜å¤§é‡ç”¨æˆ·idï¼Œå¾ˆéº»çƒ¦ï¼›ç›®çš„æ˜¯ä¸ºäº†è®¡æ•°ï¼Œè€Œä¸æ˜¯ä¿å­˜ç”¨æˆ·idï¼›å¾ˆå å†…å­˜ï¼

ä½¿ç”¨Hyperloglogï¼Œå å†…å­˜æ˜¯å›ºå®šçš„ï¼Œ2^64ä¸ªä¸åŒçš„å…ƒç´ çš„åŸºæ•°ï¼Œä»…12kb



### PFADD

å°†å…ƒç´ éƒ½æ·»åŠ åˆ°æŒ‡å®šçš„ä¸€ä¸ªå‚æ•°ä¸­

**æ ¼å¼ï¼š**`PFADD [å‚æ•°å] [å‚æ•°å€¼1] [å‚æ•°å€¼2] [å‚æ•°å€¼3] ...`

å°†å‚æ•°å€¼1~å‚æ•°å€¼3...ï¼Œå…¨éƒ¨æ·»åŠ åˆ°è¿™ä¸ªå‚æ•°åä¸­



### PFCOUNT

ç»Ÿè®¡æŒ‡å®šå‚æ•°çš„å…ƒç´ æ•°é‡

**æ ¼å¼ï¼š**`PFCOUNT [å‚æ•°å]`



### PFMERGE

å°†å¤šä¸ªå‚æ•°åˆå¹¶æˆä¸€ä¸ªæ–°çš„å‚æ•°

**æ ¼å¼ï¼š**`PFMERGE [æ–°å‚æ•°å] [æ—§å‚æ•°å1] [æ—§å‚æ•°å2] ...`





## Bitmaps

> ä½å­˜å‚¨

ç»Ÿè®¡ç”¨æˆ·ä¿¡æ¯ï¼Œæ´»è·ƒ/ä¸æ´»è·ƒï¼›ç™»å½•/ä¸ç™»é™†ï¼›ç­¾åˆ°/ä¸ç­¾åˆ°ï¼›

ç±»ä¼¼ä»¥ä¸Šï¼Œåªæœ‰ä¸¤ç§çŠ¶æ€çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨Bitmaps

Bitmapsä½å›¾ï¼Œæ•°æ®ç»“æ„ï¼Œéƒ½æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ¥è¿›è¡Œè®°å½•ï¼Œåªæœ‰0å’Œ1ä¸¤ç§çŠ¶æ€



### SETBIT

åˆ›å»ºä½å›¾

**æ ¼å¼ï¼š**setbit [å‚æ•°] [key] [0/1]

> **keyå¯ä»¥ä¸ºä»»æ„æ•°å€¼ï¼Œä¾‹å¦‚è®°å½•ä¸€å¹´çš„æ‰“å¡æ•°æ®ï¼Œå°±å¯ä»¥å¦‚ä¸‹ ğŸ‘‡ï¼š**
>
> - setbit sign 0 1
> - setbit sign 1 1
> - setbit sign 2 0





### GETBIT

è·å–ä½å›¾

**æ ¼å¼ï¼š**getbit [å‚æ•°] [key]

è·å–æŒ‡å®škeyçš„0/1





### BITCOUNT

ç»Ÿè®¡ä½å›¾ä¸­1çš„æ•°é‡

**æ ¼å¼ï¼š**BITCOUNT [å‚æ•°]

ç»Ÿè®¡æŒ‡å®šå‚æ•°ä¸­ï¼Œ1çš„æ•°é‡





# äº‹åŠ¡



## Redisçš„äº‹åŠ¡

### å¼€å¯å¹¶æ‰§è¡Œäº‹åŠ¡

> - å¼€å¯äº‹åŠ¡ï¼ˆmultiï¼‰
>
> - å‘½ä»¤å…¥é˜Ÿ
>
>   ```bash
>   set xxx xxx;
>   get xxx xxx;
>   set xxx xxx;
>   set xxx xxx;
>   ```
>
> - æ‰§è¡Œäº‹åŠ¡ï¼ˆexecï¼‰



### å¼€å¯å´å–æ¶ˆäº‹åŠ¡

- å¼€å¯äº‹åŠ¡ï¼ˆmultiï¼‰

- å‘½ä»¤å…¥é˜Ÿ

  ```bash
  set xxx xxx;
  get xxx xxx;
  set xxx xxx;
  set xxx xxx;
  ```

- æ”¾å¼ƒäº‹åŠ¡ï¼ˆdiscardï¼‰



### å¼‚å¸¸

- **ã€ç¼–è¯‘å‹å¼‚å¸¸ã€‘**å¼€å¯äº‹åŠ¡ï¼Œæ·»åŠ å‘½ä»¤åˆ°äº‹åŠ¡é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°é”™è¯¯ï¼ˆå¦‚ï¼šè¯­æ³•é”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆæ‰§è¡Œäº‹åŠ¡ä¼šæŠ¥é”™ï¼Œä¼šæ‰§è¡Œå¤±è´¥
- **ã€è¿è¡Œæ—¶å¼‚å¸¸ã€‘**å¼€å¯äº‹åŠ¡ï¼Œæ·»åŠ å‘½ä»¤åˆ°äº‹åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ‰§è¡Œäº‹åŠ¡ï¼Œä¸­é€”å‡ºç°é”™è¯¯çš„å‘½ä»¤ï¼Œä¼šæ‰§è¡Œå¤±è´¥ï¼Œä¸å½±å“å…¶ä»–äº‹åŠ¡è¿›è¡Œ





## ç›‘è§†äº‹åŠ¡ ğŸ‘‡

> **ç›‘è§†å™¨:**Watch

- **æ‚²è§‚é”ï¼š**å¾ˆæ‚²è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ï¼Œæ— è®ºåšä»€ä¹ˆéƒ½ä¼šåŠ é”ï¼ˆå½±å“æ€§èƒ½ï¼‰

- **ä¹è§‚é”ï¼š**å¾ˆä¹è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¸ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”

  æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¸€ä¸‹ï¼Œåœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰äººä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®

  > è·å–version
  >
  > æ›´æ–°çš„æ—¶å€™æ¯”è¾ƒversion



### ç›‘è§†ä¸¾ä¾‹

```bash
set money 100
set out 0
watch money     # ç›‘è§† money å¯¹è±¡

multi            # å¼€å¯äº‹åŠ¡
DECRYBY money 20
INCRYBY out 20
exec			# æ‰§è¡Œäº‹åŠ¡

#æ­£å¸¸æ‰§è¡ŒæˆåŠŸ
```



### æ¨¡æ‹Ÿå¤šçº¿ç¨‹å®ç°ä¹è§‚é”

> **å®¢æˆ·ç«¯1ï¼šmoneyå‡å°‘20ï¼ŒèŠ±è´¹å¢åŠ 20**
>
> ```bash
> watch money		# å¼€å¯ç›‘è§† money
> multi            # å¼€å¯äº‹åŠ¡
> DECRYBY money 20
> INCRYBY out 20
> ```

**æƒ…å†µä¸ºï¼šå®¢æˆ·ç«¯1 ğŸ‘† è¿˜æ²¡æœ‰æ‰§è¡Œçº¿ç¨‹ï¼Œ å®¢æˆ·ç«¯2 ğŸ‘‡ æŠŠå†…å®¹ä¿®æ”¹äº†ï¼**

> **å®¢æˆ·ç«¯2ï¼šæ”¹å˜moneyä¸º1000**
>
> ```bash
> set money 1000;
> ```

æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯1 æ‰§è¡Œäº‹åŠ¡ï¼Œä¼šæ‰§è¡Œå¤±è´¥ï¼ˆæ‰§è¡Œå‰ï¼Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯ä¿®æ”¹äº†è¢«ç›‘è§†çš„å†…å®¹ï¼‰ï¼Œç›´æ¥è¿”å›ï¼ˆnilï¼‰

æ­¤æ—¶å°±ç›¸å½“äºä½¿ç”¨Rediså®ç°äº†ä¹è§‚é”æ“ä½œï¼



### After ä¹è§‚é”ç›‘è§†å¤±è´¥

> - è§£é”ï¼Œç±»ä¼¼Mysqlä¸­æ”¾å¼ƒåŸæ¥çš„versionï¼Œè·å–æ–°çš„version
>
>   **unwatch**
>
> 
>
> - é‡æ–°ç›‘è§†ï¼Œæ‹¿åˆ°æœ€æ–°çš„å€¼ 
>
>   **watch money**





# Jedis

> **Jedisæ˜¯Rediså®˜æ–¹æ¨èçš„Javaè¿æ¥å¼€å‘å·¥å…·**

## å¯¼åŒ…

```xml
<!-- https://mvnrepository.com/artifact/com.alibaba.fastjson2/fastjson2 -->
<dependency>
    <groupId>com.alibaba.fastjson2</groupId>
    <artifactId>fastjson2</artifactId>
    <version>2.0.47</version>
</dependency>

<!-- https://mvnrepository.com/artifact/redis.clients/jedis -->
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>5.1.0</version>
</dependency>
```



## ä½¿ç”¨PINGæµ‹è¯•

```java
// 1. æ–°å»ºJediså¯¹è±¡
Jedis jedis = new Jedis("127.0.0.1",6379);
System.out.println(jedis.ping());

// è¾“å‡ºPONGï¼Œæµ‹è¯•æˆåŠŸï¼
```



## Redisè®¾ç½®å¯†ç 

**è®¾ç½®å¯†ç ï¼š**`config set requirepass [password]`

**æŸ¥çœ‹å¯†ç ï¼š**`config get requirepass`



## Jedisè¿æ¥é”®å…¥å¯†ç 

```java
jedis.auth("[password]");
```



## Jedisæµ‹è¯•ä»£ç 

```java
Jedis jedis = new Jedis("127.0.0.1", 6379);
jedis.auth("pwd");
System.out.println(jedis.ping());

System.out.println("æ¸…ç©ºæ•°æ®ï¼š" + jedis.flushDB());
System.out.println("åˆ¤æ–­æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š" + jedis.exists("username"));
System.out.println("æ–°å¢<'username','xxx'>çš„é”®å€¼å¯¹ï¼š" + jedis.set("username", "xxx"));
System.out.println("æ–°å¢<'password','password'>çš„é”®å€¼å¯¹ï¼š" + jedis.set("password", "pwd"));
System.out.print("ç³»ç»Ÿä¸­æ‰€æœ‰çš„é”®å¦‚ä¸‹ï¼š");
Set<String> keys = jedis.keys("*");
System.out.println(keys);
System.out.println("password:" + jedis.del("password"));
System.out.println("åˆ¤æ–­é”®password,æ˜¯å¦å­˜åœ¨ï¼š" + jedis.exists("password"));
System.out.println("æŸ¥çœ‹é”®usernameæ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹ï¼š" + jedis.type("username"));
System.out.println("éšæœºè¿”å›keyç©ºé—´çš„ä¸€ä¸ªï¼š" + jedis.randomKey());
System.out.println("key:" + jedis.rename("username", "name"));
System.out.println("å–å‡ºæ”¹åçš„name:" + jedis.get("name"));
System.out.println("æŒ‰ç´¢å¼•æŸ¥è¯¢ï¼š" + jedis.select(0));
System.out.println("æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°ç›®ï¼š" + jedis.dbSize());
System.out.println("æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„keyï¼š" + jedis.keys("*"));
System.out.println("åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰key:" + jedis.flushDB());
System.out.println("è¿”å›å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°ç›®ï¼š" + jedis.dbSize());
System.out.println("åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key:" + jedis.flushAll());

jedis.close();
```



## Jedisäº‹åŠ¡æµ‹è¯•ä»£ç 

> äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œç›´æ¥catchå¼‚å¸¸å¹¶å…³é—­äº‹åŠ¡

```java
Jedis jedis = new Jedis("127.0.0.1", 6379);
jedis.auth("pwd");

// æ·»åŠ æµ‹è¯•æ•°æ®
JSONObject jsonObject = new JSONObject();
jsonObject.put("username", "xxx");
jsonObject.put("password", "pwd");
String result = jsonObject.toString();

// æ¸…ç©ºæ•°æ®åº“
jedis.flushDB();

// å¼€å¯äº‹åŠ¡
Transaction multi = jedis.multi();
try {
    multi.set("user1", result);
    multi.set("user2", result);
    int i = 1 / 0;
    multi.exec();
} catch (Exception e) {
    // æ‰§è¡Œå¤±è´¥ï¼Œå…³é—­äº‹åŠ¡
    multi.discard();
    e.printStackTrace();
} finally {
    // æ‰§è¡ŒæˆåŠŸï¼Œæ‰“å°å€¼
    System.out.println(jedis.get("user1"));
    System.out.println(jedis.get("user2"));

    // å…³é—­redisè¿æ¥
    jedis.close();
}
```





# SpringBootæ•´åˆRedis

> **å‰è¨€ï¼š**
>
> SpringBoot2.xä¹‹åï¼ŒåŸæ¥ä½¿ç”¨çš„jedisè¢«æ›¿æ¢ä¸ºäº†lettuce
>
> **jedisï¼š**é‡‡ç”¨çš„ç›´è¿ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œæ˜¯ä¸å®‰å…¨çš„ï¼Œæƒ³è¦é¿å…ä¸å®‰å…¨ï¼Œéœ€è¦ä½¿ç”¨jedis poolè¿æ¥æ± ï¼ˆæ›´åƒBIOæ¨¡å¼ï¼‰
>
> **lettuceï¼š**åº•å±‚é‡‡ç”¨nettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ï¼Œä¸å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼ˆæ›´åƒNIOæ¨¡å¼ï¼‰

**Redisæœ‰ä¸€ä¸ªæ¨¡æ¿æŠ€æœ¯**

åœ¨**spring-boot-autoconfigure**çš„åŒ…ä¸­

**spring.factories**ä¸­å­˜åœ¨**RedisAutoConfiguration**

å…¶ç»‘å®šäº†**RedisProperties**ï¼Œå¹¶ä¸”å…¶ä¸­æ³¨å…¥äº†**RedisTemplateæ¨¡æ¿**

å…¶ä¸Šæ ‡æœ‰æ³¨è§£**@ConditionalOnMissingBean(name = "redisTemplate")**

è¡¨ç¤ºå¦‚æœè‡ªå·±å†™äº†ä¸€ä¸ª**redisTemplateç±»**ï¼Œå°±å¯ä»¥æ›¿æ¢æ‰è¿™ä¸ªæ¨¡æ¿

**é»˜è®¤çš„RedisTemplate**æ²¡æœ‰è¿‡å¤šçš„è®¾ç½®ï¼Œè€Œ**æˆ‘ä»¬ä½¿ç”¨Redis**æ˜¯éœ€è¦åºåˆ—åŒ–çš„



## å¯¼åŒ…

```xml
<dependency>
    <groupId>io.lettuce</groupId>
    <artifactId>lettuce-core</artifactId>
    <version>6.3.1.RELEASE</version>
    <scope>compile</scope>
</dependency>
<dependency>
    <groupId>org.springframework.data</groupId>
    <artifactId>spring-data-redis</artifactId>
    <version>3.2.3</version>
    <scope>compile</scope>
</dependency>
```



## æ·»åŠ é…ç½®æ–‡ä»¶

```yaml
spring:
  data:
    redis:
      host: 127.0.0.1
      port: 6379
      password: pwd
```

**æ³¨æ„ï¼š**å¦‚æœéœ€è¦é…ç½®è¿æ¥æ± ç­‰å†…å®¹ï¼Œéœ€è¦é€‰æ‹©lettueè¿›è¡Œé…ç½®ï¼Œè€Œä¸æ˜¯jedis



## æµ‹è¯•

> **å‰è¨€**
>
> OPSä»‹ç»ï¼šoperation per second æ¯ç§’æ“ä½œæ¬¡æ•°

**è·å–æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼Œæµ‹è¯•æ¸…ç©º**

```java
RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();;
connection.flushAll();
connection.flushDb();
```



**å¸¸ç”¨æ–¹æ³•å¯ç›´æ¥é€šè¿‡redisTemplateæ“ä½œï¼Œæ¯”å¦‚äº‹åŠ¡å’ŒåŸºæœ¬çš„crud**

> - **redisTempLateï¼šæ“ä½œä¸åŒçš„æ•°æ®ç±»å‹ï¼Œapiå’Œæˆ‘ä»¬çš„æŒ‡ä»¤æ˜¯ä¸€æ ·çš„**
> - **opsForVaLueï¼šæ“ä½œå­—ç¬¦ä¸²ç±»ä¼¼string**
> - **opsForListï¼šæ“ä½œListç±»ä¼¼List**
> - **opsForSet**
> - **opsForHash**
> - **opsForZSet**
> - **opsForGeo**
> - **opsForHyperLogLog**



## åºåˆ—åŒ–é“ºå«

åœ¨Javaç¨‹åºä¸­ï¼Œæ²¡æœ‰åºåˆ—åŒ–ï¼Œè¿›è¡Œé”®å€¼å¯¹çš„åˆ›å»ºï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢å‡ºç°ä¹±ç 

```bash
127.0.0.1:6379> keys *
1) "\xac\xed\x00\x05t\x00\busername"
```





## ç¼–å†™è‡ªå·±çš„Redisé…ç½®ç±»

```java
@Configuration
public class RedisConfig {
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory){
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(redisConnectionFactory);
        return template;
    }
}
```





## åºåˆ—åŒ–æµ‹è¯•

> ä½¿ç”¨å¦‚ä¸‹ä»£ç å¾€redisä¸­æ’å…¥userå¯¹è±¡ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¯¥Userå¯¹è±¡æ²¡æœ‰è¿›è¡Œåºåˆ—åŒ–

```java
User user = new User("å§“å", 18);
redisTemplate.opsForValue().set("user",user);
System.out.println(redisTemplate.opsForValue().get("user"));
```



> **è§£å†³æ–¹æ³•å…¶ä¸€ï¼š**å°†userè½¬ä¸ºjsonåºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¼ å…¥redis

```java
User user = new User("å§“å", 18);
String userJson = new ObjectMapper().writeValueAsString(user);
redisTemplate.opsForValue().set("user",userJson);
System.out.println(redisTemplate.opsForValue().get("user"));
```



> **è§£å†³æ–¹æ³•å…¶äºŒï¼š**æ‰€æœ‰å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼

```java
public class User implements Serializable {
    private String name;
    private Integer age;
}
```



> **æœ€ä¼˜è§£å†³æ–¹æ¡ˆï¼š**åœ¨Redisé…ç½®ç±»ä¸­è¿›è¡Œåºåˆ—åŒ–ç›¸å…³é…ç½® ğŸ‘‡

## è‡ªå·±å®šä¹‰RedisTemplate

> **@SuppressWarningsï¼š**å¿½ç•¥æ‰€æœ‰è­¦å‘Šï¼ˆé»„è‰²ä¸‹åˆ’çº¿...ï¼‰
>
> åœ¨**SpringBoot3.x**ä¸­ï¼Œå†™å…¥äº†è¯¥Configurationåï¼Œä½¿ç”¨**@Autowiredæ³¨å…¥çš„RedisTemplate**ä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªæ¥è·‘
>
> åœ¨**SpringBoot2.x**ä¸­å¯èƒ½éœ€è¦åœ¨**@Autowiredä¸‹é¢åŠ å…¥ä¸€ä¸ª@Qualifier("redisTemplate")**æ¥æŒ‡å®šè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„
>
> ä¹Ÿå¯ä»¥å°è¯•æŠŠ**@Autowiredæ³¨å…¥çš„RedisTemplate**åŠ å…¥æ³›å‹ï¼Œå†™ä¸º<String,Object>ï¼Œä¸é»˜è®¤<Object,Object>ä¸åŒï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåˆ°è‡ªå®šä¹‰çš„RedisTemplate

```java
/**
 * @author Chenix
 * @create 2024-03-22 19:02
 */
@Configuration
public class RedisConfig {
    @Bean
    @SuppressWarnings("all")
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        // ä¸ºäº†è‡ªå·±å¼€å‘æ–¹ä¾¿ï¼Œä¸€èˆ¬ç›´æ¥ä½¿ç”¨<String, Object>ç±»å‹
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);

        // åºåˆ—åŒ–é…ç½®
        // jsonçš„åºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> objectJackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        objectJackson2JsonRedisSerializer.setObjectMapper(om);

        // Stringçš„åºåˆ—åŒ–
        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
        // keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
        template.setKeySerializer(stringRedisSerializer);
        // hashçš„keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
        template.setHashKeySerializer(stringRedisSerializer);
        // valueé‡‡ç”¨jacksonçš„åºåˆ—åŒ–æ–¹å¼
        template.setValueSerializer(objectJackson2JsonRedisSerializer);
        // hashçš„valueé‡‡ç”¨jacksonçš„åºåˆ—åŒ–æ–¹å¼
        template.setHashValueSerializer(objectJackson2JsonRedisSerializer);

        template.afterPropertiesSet();

        return template;
    }
}
```



## RedisUtils

> **å‰è¨€ï¼š**
>
> ä½¿ç”¨åŸç”Ÿçš„RedisåŠOPSæ“ä½œè¿‡äºç¹ç

ç¼–å†™ä¸€ä¸ªRedisUtilsï¼Œå¹¶ä½¿ç”¨**@Component**æ³¨å…¥åˆ°å®¹å™¨

åœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹ä½¿ç”¨**@Autowired**æ³¨å…¥è°ƒç”¨

### ç½‘ä¸ŠæŠ„çš„ä¸€ç‰ˆ

> [ã€RedisUtilså·¥å…·ç±»ä¸“é¢˜ã€‘SpringBootä¸­RedisUtilså·¥å…·ç±»é…ç½®åŠç›´æ¥ä½¿ç”¨_springboot çš„redisutils-CSDNåšå®¢](https://blog.csdn.net/qq_53641150/article/details/124180922)
>
> -utils
>
> â€‹	-RedisUtils02.java

**éœ€è¦å…ˆå¼•å…¥fastjson**

```java
package com.xxx.utils;

import com.alibaba.fastjson.support.spring.GenericFastJsonRedisSerializer;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;
import org.springframework.stereotype.Component;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.TimeUnit;

@Component
public class RedisUtils02 {
    private static RedisTemplate<String, Object> redisTemplate;
    public static RedisTemplate<String, Object> getRedisTemplate() {
        return redisTemplate;
    }
    @Autowired
    private RedisUtils02(RedisConnectionFactory redisConnectionFactory){
        // redisTemplateæ¨¡æ¿åˆå§‹åŒ–
        redisTemplate = new RedisTemplate<>();
        redisTemplate.setConnectionFactory(redisConnectionFactory);
        // Stringçš„åºåˆ—åŒ–
        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
        // jsonåºåˆ—åŒ–é…ç½®
        GenericFastJsonRedisSerializer jackson2JsonRedisSerializer = new GenericFastJsonRedisSerializer();
        //keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
        redisTemplate.setKeySerializer(stringRedisSerializer);
        //hashçš„keyä¹Ÿé‡‡ç”¨String çš„åºåˆ—åŒ–æ–¹å¼
        redisTemplate.setHashKeySerializer(stringRedisSerializer);
        //valueçš„åºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jacksonçš„æ–¹å¼
        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);
        //hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson
        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);
        redisTemplate.afterPropertiesSet();
    }

    // =============================common============================
    /**
     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´
     * @param key  é”®
     * @param time æ—¶é—´(ç§’)
     */
    public static boolean expire(String key, long time) {
        try {
            if (time > 0) {
                redisTemplate.expire(key, time, TimeUnit.SECONDS);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´
     * @param key é”® ä¸èƒ½ä¸ºnull
     * @return æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ
     */
    public static long getExpire(String key) {
        return redisTemplate.getExpire(key, TimeUnit.SECONDS);
    }


    /**
     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨
     * @param key é”®
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public static boolean hasKey(String key) {
        try {
            return redisTemplate.hasKey(key);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * åˆ é™¤ç¼“å­˜
     * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª
     */
//    @SuppressWarnings("unchecked")
    public static void del(String... key) {
        if (key != null && key.length > 0) {
            if (key.length == 1) {
                redisTemplate.delete(key[0]);
            } else {
                redisTemplate.delete(Arrays.asList(key));
//                redisTemplate.delete(CollectionUtils.arrayToList(key));
            }
        }
    }

    /**
     * è·å–å¹¶åˆ é™¤ç¼“å­˜
     * @param key é”®
     * @return å€¼
     */
    public static Object getAndDelete(String key) {
        try{
            return key == null ? null : get(key);
        }finally {
            del(key);
        }
    }

    // ============================String=============================

    /**
     * æ™®é€šç¼“å­˜è·å–
     * @param key é”®
     * @return å€¼
     */
    public static Object get(String key) {
        return key == null ? null : redisTemplate.opsForValue().get(key);
    }

    /**
     * æ™®é€šç¼“å­˜æ”¾å…¥
     * @param key   é”®
     * @param value å€¼
     * @return trueæˆåŠŸ falseå¤±è´¥
     */

    public static boolean set(String key, Object value) {
        try {
            redisTemplate.opsForValue().set(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´
     * @param key   é”®
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ
     * @return trueæˆåŠŸ false å¤±è´¥
     */

    public static boolean set(String key, Object value, long time) {
        try {
            if (time > 0) {
                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * é€’å¢
     * @param key   é”®
     * @param delta è¦å¢åŠ å‡ (å¤§äº0)
     */
    public static long incr(String key, long delta) {
        if (delta < 0) {
            throw new RuntimeException("é€’å¢å› å­å¿…é¡»å¤§äº0");
        }
        return redisTemplate.opsForValue().increment(key, delta);
    }


    /**
     * é€’å‡
     * @param key   é”®
     * @param delta è¦å‡å°‘å‡ (å°äº0)
     */
    public static long decr(String key, long delta) {
        if (delta < 0) {
            throw new RuntimeException("é€’å‡å› å­å¿…é¡»å¤§äº0");
        }
        return redisTemplate.opsForValue().increment(key, -delta);
    }


    // ================================Map=================================

    /**
     * HashGet
     * @param key  é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ ä¸èƒ½ä¸ºnull
     */
    public static Object hget(String key, String item) {
        return redisTemplate.opsForHash().get(key, item);
    }

    /**
     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼
     * @param key é”®
     * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼
     */
    public static Map<Object, Object> hmget(String key) {
        return redisTemplate.opsForHash().entries(key);
    }

    /**
     * HashSet
     * @param key é”®
     * @param map å¯¹åº”å¤šä¸ªé”®å€¼
     */
    public static boolean hmset(String key, Map<String, Object> map) {
        try {
            redisTemplate.opsForHash().putAll(key, map);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * HashSet å¹¶è®¾ç½®æ—¶é—´
     * @param key  é”®
     * @param map  å¯¹åº”å¤šä¸ªé”®å€¼
     * @param time æ—¶é—´(ç§’)
     * @return trueæˆåŠŸ falseå¤±è´¥
     */
    public static boolean hmset(String key, Map<String, Object> map, long time) {
        try {
            if (time > 0) {
                redisTemplate.opsForHash().putAll(key, map);
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º
     *
     * @param key   é”®
     * @param item  é¡¹
     * @param value å€¼
     * @return true æˆåŠŸ falseå¤±è´¥
     */
    public static boolean hset(String key, String item, Object value) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º
     *
     * @param key   é”®
     * @param item  é¡¹
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’) æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´
     * @return true æˆåŠŸ falseå¤±è´¥
     */
    public static boolean hset(String key, String item, Object value, long time) {
        try {
            if (time > 0) {
                redisTemplate.opsForHash().put(key, item, value);
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * åˆ é™¤hashè¡¨ä¸­çš„å€¼
     *
     * @param key  é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull
     */
    public static void hdel(String key, Object... item) {
        redisTemplate.opsForHash().delete(key, item);
    }


    /**
     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼
     *
     * @param key  é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ ä¸èƒ½ä¸ºnull
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public static boolean hHasKey(String key, String item) {
        return redisTemplate.opsForHash().hasKey(key, item);
    }


    /**
     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›
     *
     * @param key  é”®
     * @param item é¡¹
     * @param by   è¦å¢åŠ å‡ (å¤§äº0)
     */
    public static double hincr(String key, String item, double by) {
        return redisTemplate.opsForHash().increment(key, item, by);
    }


    /**
     * hashé€’å‡
     *
     * @param key  é”®
     * @param item é¡¹
     * @param by   è¦å‡å°‘è®°(å°äº0)
     */
    public static double hdecr(String key, String item, double by) {
        return redisTemplate.opsForHash().increment(key, item, -by);
    }


    // ============================set=============================

    /**
     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼
     * @param key é”®
     */
    public static Set<Object> sGet(String key) {
        try {
            return redisTemplate.opsForSet().members(key);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }


    /**
     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨
     *
     * @param key   é”®
     * @param value å€¼
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public static boolean sHasKey(String key, Object value) {
        try {
            return redisTemplate.opsForSet().isMember(key, value);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜
     *
     * @param key    é”®
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return æˆåŠŸä¸ªæ•°
     */
    public static long sSet(String key, Object... values) {
        try {
            return redisTemplate.opsForSet().add(key, values);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜
     *
     * @param key    é”®
     * @param time   æ—¶é—´(ç§’)
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return æˆåŠŸä¸ªæ•°
     */
    public static long sSetAndTime(String key, long time, Object... values) {
        try {
            Long count = (long)values.length;
            if (time > 0) {
                count = redisTemplate.opsForSet().add(key, values);
                expire(key, time);
            }
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * è·å–setç¼“å­˜çš„é•¿åº¦
     *
     * @param key é”®
     */
    public static long sGetSetSize(String key) {
        try {
            return redisTemplate.opsForSet().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * ç§»é™¤å€¼ä¸ºvalueçš„
     *
     * @param key    é”®
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return ç§»é™¤çš„ä¸ªæ•°
     */

    public static long setRemove(String key, Object... values) {
        try {
            return redisTemplate.opsForSet().remove(key, values);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    // ===============================list=================================

    /**
     * è·å–listç¼“å­˜çš„å†…å®¹
     *
     * @param key   é”®
     * @param start å¼€å§‹
     * @param end   ç»“æŸ 0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼
     */
    public static List<Object> lGet(String key, long start, long end) {
        try {
            return redisTemplate.opsForList().range(key, start, end);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }


    /**
     * è·å–listç¼“å­˜çš„é•¿åº¦
     *
     * @param key é”®
     */
    public static long lGetListSize(String key) {
        try {
            return redisTemplate.opsForList().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼
     *
     * @param key   é”®
     * @param index ç´¢å¼• index>=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index<0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨
     */
    public static Object lGetIndex(String key, long index) {
        try {
            return redisTemplate.opsForList().index(key, index);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     *
     * @param key   é”®
     * @param value å€¼
     */
    public static boolean lSet(String key, Object value) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     * @param key   é”®
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’)
     */
    public static boolean lSet(String key, Object value, long time) {
        try {
            if (time > 0) {
                redisTemplate.opsForList().rightPush(key, value);
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     *
     * @param key   é”®
     * @param value å€¼
     * @return true å­˜æ”¾æˆåŠŸ falseå­˜æ”¾å¤±è´¥
     */
    public static boolean lSet(String key, List<Object> value) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     *
     * @param key   é”®
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’)
     * @return true å­˜æ”¾æˆåŠŸ falseå­˜æ”¾å¤±è´¥
     */
    public static boolean lSet(String key, List<Object> value, long time) {
        try {
            if (time > 0) {
                redisTemplate.opsForList().rightPushAll(key, value);
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®
     *
     * @param key   é”®
     * @param index ç´¢å¼•
     * @param value å€¼
     * @return true å­˜æ”¾æˆåŠŸ falseå­˜æ”¾å¤±è´¥
     */

    public static boolean lUpdateIndex(String key, long index, Object value) {
        try {
            redisTemplate.opsForList().set(key, index, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue
     *
     * @param key   é”®
     * @param count ç§»é™¤å¤šå°‘ä¸ª
     * @param value å€¼
     * @return ç§»é™¤çš„ä¸ªæ•°
     */

    public static long lRemove(String key, long count, Object value) {
        try {
            return redisTemplate.opsForList().remove(key, count, value);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }
}
```



## æµ‹è¯•RedisUtils

```java
@Test
public void testByRedisUtils() {
    RedisUtils02.set("username", "xxx");
    System.out.println(RedisUtils02.get("username"));
}
```





# ğŸ‘† ä¸ºåŸºç¡€ï¼Œ è¿›é˜¶ ğŸ‘‡





# Redis.confé…ç½®æ–‡ä»¶

...

### save

> **[å¤šå°‘]så†…è‡³å°‘æœ‰[å‡ ]ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–**
>
> save 900 1
>
> save 300 10
>
> save 60 10000





### stop-writes-on-bgsave-error

> **åœ¨æŒä¹…åŒ–å‡ºé”™çš„æ—¶å€™ï¼Œåœæ­¢å†™å…¥**
>
> stop-writes-on-bgsave-error yes





### rdbcompression

> **æ˜¯å¦å‹ç¼©rdbæ–‡ä»¶ï¼Œéœ€è¦æ¶ˆè€—ä¸€äº›cpuèµ„æºï¼Œå¦‚æœå¯¹çº¿ä¸Šè¦æ±‚é«˜ï¼Œå¯ä»¥å…³æ‰**
>
> rdbcompression yes





### maxmemory-policy

> **maxmemory-policy** noeviction

> 1.volatile-lru(least recently used):æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®keyä¸­é€‰æ‹©ç©ºè½¬æ—¶é—´æœ€é•¿çš„é”®å€¼å¯¹æ¸…é™¤æ‰ï¼›
>
> 2.volatile-lfu(least frequently used):æœ€è¿‘æœ€ä¸ç»å¸¸ä½¿ç”¨ç®—æ³•ï¼Œä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é€‰æ‹©æŸæ®µæ—¶é—´ä¹‹å†…ä½¿ç”¨é¢‘æ¬¡æœ€å°çš„é”®å€¼å¯¹æ¸…é™¤æ‰ï¼›
>
> 3.volatile-ttl:ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é€‰æ‹©è¿‡æœŸæ—¶é—´æœ€æ—©çš„é”®å€¼å¯¹æ¸…é™¤ï¼›
>
> 4.volatile-random:ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œéšæœºé€‰æ‹©é”®è¿›è¡Œæ¸…é™¤ï¼›
>
> 5.allkeys-lru:æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œä»æ‰€æœ‰çš„é”®ä¸­é€‰æ‹©ç©ºè½¬æ—¶é—´æœ€é•¿çš„é”®å€¼å¯¹æ¸…é™¤ï¼›
>
> 6.allkeys-lfu:æœ€è¿‘æœ€ä¸ç»å¸¸ä½¿ç”¨ç®—æ³•ï¼Œä»æ‰€æœ‰çš„é”®ä¸­é€‰æ‹©æŸæ®µæ—¶é—´ä¹‹å†…ä½¿ç”¨é¢‘æ¬¡æœ€å°‘çš„é”®å€¼å¯¹æ¸…é™¤ï¼›
>
> 7.allkeys-random:æ‰€æœ‰çš„é”®ä¸­ï¼Œéšæœºé€‰æ‹©é”®è¿›è¡Œåˆ é™¤ï¼›
>
> 8.noeviction:ä¸åšä»»ä½•çš„æ¸…ç†å·¥ä½œï¼Œåœ¨redisçš„å†…å­˜è¶…è¿‡é™åˆ¶ä¹‹åï¼Œæ‰€æœ‰çš„å†™å…¥æ“ä½œéƒ½ä¼šè¿”å›é”™è¯¯ï¼›ä½†æ˜¯è¯»æ“ä½œéƒ½èƒ½æ­£å¸¸çš„è¿›è¡Œ;



### appendonly

> **é»˜è®¤æ˜¯ä¸å¼€å¯aofæ¨¡å¼çš„ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œrdbå®Œå…¨å¤Ÿç”¨**
>
> appendonly no

> **æ‰§è¡Œsyncé¢‘ç‡**
>
> appendfsync [å‚æ•°]
>
> - everysec  **æ¯ç§’**
> - always	**æ¯æ¬¡ä¿®æ”¹éƒ½æ‰§è¡Œï¼ˆæ¶ˆè€—æ€§èƒ½ï¼‰**
> - no		**ä¸æ‰§è¡Œsyncï¼Œæ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«**





# RedisæŒä¹…åŒ–





# AOF

appendonly.aof

å¦‚æœaofæ–‡ä»¶æœ‰é”™è¯¯ï¼Œredisæ˜¯æ— æ³•å¯åŠ¨çš„ï¼Œéœ€è¦ä¿®å¤è¿™ä¸ªaof

redisæä¾›äº†ä¿®å¤å·¥å…·ï¼šredis-check-aofï¼Œå°±åœ¨redis-serveråŒçº§ç›®å½•

`redis-check-aof --fix appendonly.aof`



# Rediså‘å¸ƒè®¢é˜…

## è®¢é˜…ç«¯

**`SUBSCRIBE [channel]`**

è®¢é˜…ä¸€ä¸ªé¢‘é“ï¼Œç›‘å¬è¯¥é¢‘é“å‘å¸ƒçš„æ‰€æœ‰æ–°æ¶ˆæ¯ï¼Œç­‰å¾…è¯»å–...

> **æ¥æ”¶åˆ°çš„æ¨é€æ¶ˆæ¯æ ¼å¼**
>
> "message"
>
> "[channel]"ï¼ˆé¢‘é“åç§°ï¼‰
>
> "[message]"ï¼ˆæ¶ˆæ¯çš„å…·ä½“å†…å®¹ï¼‰



## å‘é€ç«¯

**`PUBLISH [channel] "message"`**

æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé¢‘é“





# Redisä¸»ä»å¤åˆ¶

**ä¸€å°æœåŠ¡å™¨æ¨¡æ‹Ÿä¸»ä»å¤åˆ¶ï¼Œå¯åŠ¨ä¸‰ä¸ªredisæœåŠ¡ï¼š**

åˆ†åˆ«ä½¿ç”¨ä¸‰ä¸ªä¸åŒçš„é…ç½®æ–‡ä»¶



**ä½œç”¨ï¼š**

- æ•°æ®å†—ä½™
- æ•…éšœæ¢å¤
- è´Ÿè½½å‡è¡¡
- é«˜å¯ç”¨ï¼ˆé›†ç¾¤ï¼‰åŸºçŸ³



## ç¯å¢ƒé…ç½®

åªé…ç½®ä»åº“ï¼Œä¸é…ç½®ä¸»åº“

**`info replication`**ï¼šæŸ¥çœ‹å½“å‰åº“çš„ä¿¡æ¯

1. æŠŠredis.confå¤åˆ¶ä¸‰ä¸ªï¼Œå‘½åå¯ä»¥æŒ‰**redis[ç«¯å£].conf**
2. ç«¯å£ï¼šä¸»åº“ä¸å˜ï¼Œä»åº“éƒ½ä¿®æ”¹ä¸ºä¸åŒçš„ç«¯å£
3. **ä»åº“**ä¿®æ”¹profile /var/**runredis_6379.pid**ä¸º**runredis_[ä»åº“ç«¯å£].pid**
4. **ä¸»åº“ä»åº“**éƒ½è¦ä¿®æ”¹**logfileä¸ºâ€œ[ç«¯å£].logâ€**
5. **ä¸»åº“ä»åº“**éƒ½è¦ä¿®æ”¹**dbfilename dump.rdb**ä¸º**dump[ç«¯å£].rdb**
6. ä¿å­˜é€€å‡ºï¼Œé…ç½®å¦å¤–ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œ2-5æ­¥éª¤



æŠŠä¸€å°æœåŠ¡å™¨ä¸»æœºå¼€å››ä¸ªä¼šè¯

å…¶ä¸­ä¸‰ä¸ªæ‰§è¡Œä»åº“é…ç½®æ–‡ä»¶ï¼š**`redis-server config/redis[ç«¯å£].conf`**

ç¬¬å››ä¸ªç”¨æ¥**æŸ¥çœ‹æœåŠ¡å¯åŠ¨æƒ…å†µï¼š** `ps -ef|grep redis`



## é…ç½®ä¸€ä¸»äºŒä»

**é»˜è®¤æƒ…å†µï¼Œæ¯ä¸€å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹**

å°†åˆšæ‰çš„ä¸‰å°RedisæœåŠ¡ï¼Œå¯åŠ¨å¯¹åº”å®¢æˆ·ç«¯ï¼Œä½¿ç”¨info replicationå‘½ä»¤æŸ¥çœ‹ï¼Œå‘ç°éƒ½æ˜¯ä¸»æœº

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»…é…ç½®ä»æœºå³å¯



### è®¾è‡ªå·±ä¸ºä»æœºï¼Œè®¤ä¸»æœº

#### ä½¿ç”¨å‘½ä»¤é…ç½®ä»æœºï¼ˆæš‚æ—¶ï¼‰

`SLAVEOF 127.0.0.1 6379`

è¡¨ç¤º ï¼š å½“å‰ç«¯å£ï¼ˆé6379ï¼‰å¼€å¯çš„redisæœåŠ¡ï¼Œè®¤æœ¬åœ°ç«¯å£ä¸º6379çš„redisæœåŠ¡ä¸ºä¸»æœº

æ­¤æ—¶å†ä½¿ç”¨ `info replication` å°±å¯ä»¥çœ‹åˆ° roleä¸ºslaveä»æœº

åœ¨ä¸»æœºä¸‹å†æ¬¡ä½¿ç”¨ `info replication` å¯ä»¥çœ‹åˆ° `connected_salaves: x`

xä»£è¡¨çš„å°±æ˜¯**ä»æœºæ•°é‡**

ä¹Ÿå¯ä»¥çœ‹åˆ°ä»æœºçš„ç›¸å…³ä¿¡æ¯ï¼š

`slave[x]ï¼šip=...ï¼Œport=..ï¼Œstate=...,offset=...,lag=...`

> **çœŸå®çš„ä¸»ä»é…ç½®åº”è¯¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œè¿™æ ·çš„è¯æ‰æ˜¯æ°¸ä¹…çš„ï¼**
>
> **ä½¿ç”¨å‘½ä»¤é…ç½®çš„åªæ˜¯æš‚æ—¶çš„ï¼Œå½“ä»æœºå…³æœºå†æ¬¡å¯åŠ¨åï¼Œä»–åˆè‡ªåŠ¨å˜ä¸ºä¸»æœºäº†**
>
> **æ­¤æ—¶é‡æ–°å˜ä¸ºä»æœºï¼Œé©¬ä¸ŠåŒæ­¥ä¸»æœºçš„æ‰€æœ‰æ•°æ®ä¸ä¿¡æ¯**



#### ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ä»æœº

åœ¨redis.confä¸­

> #è®¾ç½®å½“æœ¬æœºä¸ºslavæœåŠ¡æ—¶ï¼Œè®¾ç½®masteræœåŠ¡çš„IPåœ°å€åŠç«¯å£ï¼Œåœ¨Rediså¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä»masterè¿›è¡Œæ•°æ®åŒæ­¥
>
> `slaveof <masterip> <masterport>`
>
> #å½“masteræœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼ŒslavæœåŠ¡è¿æ¥masterçš„å¯†ç 
>
> `masterauth <master-password>`



## è¡¥å……

ä¸»æœºå¯ä»¥å†™ï¼Œä»æœºä¸èƒ½å†™ï¼Œåªèƒ½è¯»

ä¸»æœºä¸­çš„æ‰€æœ‰ä¿¡æ¯å’Œæ•°æ®ï¼Œéƒ½ä¼šè¢«ä»æœºä¿å­˜

**æµ‹è¯•é«˜å¯ç”¨ï¼š** ä¸»æœºæ–­å¼€è¿æ¥ï¼Œä»æœºä¾æ—§è¿æ¥åˆ°ä¸»æœºï¼Œä½†æ˜¯æ²¡æœ‰å†™çš„æ“ä½œï¼Œè¿™æ—¶å€™å¦‚æœä¸»æœºå›æ¥ï¼Œä»æœºä¾æ—§å¯ä»¥è·å–ä¸»æœºçš„å†™æ“ä½œ

**ç›®æ ‡ï¼š** ä¸»æœºæ–­äº†ï¼Œä»æœºä¸­çš„ä¸€ä¸ªå˜ä¸ºä¸»æœº



## å¤åˆ¶åŸç†

Slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤

Masteræ¥åˆ°å‘½ä»¤ï¼Œå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,å¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚

**å…¨é‡å¤åˆ¶ï¼š** è€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚

**å¢é‡å¤åˆ¶ï¼š** Masterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥

ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰å°†è¢«è‡ªåŠ¨æ‰§è¡Œï¼æˆ‘ä»¬çš„æ•°æ®ä¸€å®šå¯ä»¥åœ¨ä»æœºä¸­çœ‹åˆ°ï¼























