ssm..é¡¹ç›®æ‰“åŒ…ä¸ºwaråœ¨tomcatè¿è¡Œ

springbootå†…åµŒtomcatï¼Œç›´æ¥è¿è¡Œï¼Œå¾®æœåŠ¡æ¶æ„ï¼

æ–°æœåŠ¡æ¶æ„ï¼šæœåŠ¡ç½‘æ ¼ï¼

è´­ä¹°å•†å“æµç¨‹ï¼š

ä»“åº“å†»ç»“ã€èµ„é‡‘å†»ç»“ã€éªŒè¯ï¼›è´­ä¹°æˆåŠŸï¼Œä»“åº“æ•°é‡å‡å°‘ï¼Œä»“åº“è§£å†»ï¼Œèµ„é‡‘è§£å†»



# ç¬¬ä¸€ä¸ªSpringBootç¨‹åº

## æ–°å»ºé¡¹ç›®çš„æ–¹æ³•

- Springå®˜æ–¹ç½‘ç«™æ–°å»ºï¼ˆ[Spring Initializr](https://start.spring.io/)ï¼‰
- ä½¿ç”¨é›†æˆäº†SpringBootçš„IDEAæ–°å»º



## çƒ­éƒ¨ç½²

```xml
<!--devtoolsçƒ­éƒ¨ç½²-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <optional>true</optional>
    <scope>true</scope>
</dependency>
```

> - ä¿®æ”¹ç±»â€“>ä¿å­˜ï¼šåº”ç”¨ä¼šé‡å¯
> - ä¿®æ”¹é…ç½®æ–‡ä»¶â€“>ä¿å­˜ï¼šåº”ç”¨ä¼šé‡å¯
> - ä¿®æ”¹é¡µé¢â€“>ä¿å­˜ï¼šåº”ç”¨ä¸ä¼šé‡å¯ï¼Œä½†ä¼šé‡æ–°åŠ è½½ï¼Œé¡µé¢ä¼šåˆ·æ–°

```yaml
spring:
  devtools:
    restart:
      enabled: true  #è®¾ç½®å¼€å¯çƒ­éƒ¨ç½²
      additional-paths: src/main/java #é‡å¯ç›®å½•
      exclude: WEB-INF/**
  freemarker:
    cache: false    #é¡µé¢ä¸åŠ è½½ç¼“å­˜ï¼Œä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
```

 



## è‡ªå®šä¹‰LOGOèœå•

> -resources
>
> â€‹	-banner.txt

banner.txtå†™å…¥asciiå­—ç¬¦ï¼Œå¯è¢«è¯»å–ä¸ºå¯åŠ¨ç¨‹åºæ˜¾ç¤ºçš„æ ·å¼



# åŸç†åˆçª¥

## è‡ªåŠ¨è£…é…

### pom.xml

- spring-boot-dependenciesï¼šæ ¸å¿ƒä¾èµ–åœ¨çˆ¶å·¥ç¨‹ä¸­ï¼
- å¼•å…¥springbootä¾èµ–ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼Œå°±æ˜¯æœ‰ç‰ˆæœ¬ä»“åº“



### å¯åŠ¨å™¨

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
</dependency>
```

- å¯åŠ¨å™¨ï¼šè¯´ç™½äº†å°±æ˜¯Springbootçš„å¯åŠ¨åœºæ™¯ï¼›
- æ¯”å¦‚spring-boot-starter-web,ä»–å°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¯¼å…¥webç¯å¢ƒæ‰€æœ‰çš„ä¾èµ–ï¼
- springbootä¼šå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯ï¼Œéƒ½å˜æˆä¸€ä¸ªä¸ªçš„å¯åŠ¨å™¨
- æˆ‘ä»¬è¦ä½¿ç”¨ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±åªéœ€è¦æ‰¾åˆ°å¯¹åº”çš„å¯åŠ¨å™¨å°±å¯ä»¥äº†`starter`

,å¯åŠ¨å™¨ï¼šè¯´ç™½äº†å°±æ˜¯Springbootçš„å¯åŠ¨åœºæ™¯ï¼›
æ¯”å¦‚spring-boot-starter-web,ä»–å°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¯¼å…¥webç¯å¢ƒæ‰€æœ‰çš„ä¾èµ–ï¼
Â·springbootä¼šå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯ï¼Œéƒ½å˜æˆä¸€ä¸ªä¸ªçš„å¯åŠ¨å™¨
æˆ‘ä»¬è¦ä½¿ç”¨ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±åªéœ€è¦æ‰¾åˆ°å¯¹åº”çš„å¯åŠ¨å™¨å°±å¯ä»¥äº†
starter



é…ç½®æ–‡ä»¶ï¼ˆyamlï¼‰



# å±æ€§èµ‹å€¼

## @Valueæ³¨è§£

```java
public class Student {
    @Value("åå­—1")
    private String name;
    private Integer age;
    private Boolean happy;
    private Date birth;
    private Map<String,Object> maps;
    private List<Object> lists;
    private Teacher teacher;
}
```



## é…ç½®æ–‡ä»¶

### å¼•å…¥ä¾èµ–

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```



### application.yamlä¸­å†™å…¥å€¼

```yaml
student:
  name: ä½ å¥½
  age: 17
  happy: false
  birth: 2020/10/10
  maps: { k1: v1,k2: v2 }
  lists:
    - code
    - music
    - girl
  teacher:
    name: è€å¸ˆ1å·
    teachAge: 20
```



### é…ç½®æ³¨è§£ (1)

`@ConfigurationProperties(prefix = "student")`

**æ³¨æ„ï¼š**å¿…é¡»ä½¿ç”¨ `@Component`

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@ConfigurationProperties(prefix = "student")
public class Student {
    @Value("åå­—1")
    private String name;
    private Integer age;
    private Boolean happy;
    private Date birth;
    private Map<String,Object> maps;
    private List<Object> lists;
    private Teacher teacher;
}
```

```yaml
student:
  name: ä½ å¥½
  age: 17
  happy: false
  birth: 2020/10/10
  maps: { k1: v1,k2: v2 }
  lists:
    - code
    - music
    - girl
  teacher:
    name: è€å¸ˆ1å·
    teachAge: 20
```



### é…ç½®æ³¨è§£ (æŒ‡å®šé…ç½®æ–‡ä»¶)

`@PropertySource(value = "classpath:xxx.properties")`

é…åˆ  `@Value`

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@PropertySource(value = "classpath:xxx.properties")
public class Student {
    @Value("${name}")
    private String name;
    private Integer age;
    private Boolean happy;
    private Date birth;
    private Map<String, Object> maps;
    private List<Object> lists;
    private Teacher teacher;
}
```

```properties
name=ä½ å¥½
age=17
happy=false
birth=2020/10/10
maps={ k1= v1,k2= v2 }
lists=[1,2,3]
teacher.teachAge=20
teacher.name=20
```



### yamlä¸­é…ç½®åŠ¨æ€å€¼

```yaml
student:
  name: ä½ å¥½${random.uuid}
  age: ${random.int}
  happy: false
  birth: 2020/10/10
  maps: { k1: v1,k2: v2 }
  hello: kkk
  lists:
    - code
    - music
    - girl
  teacher:
    name: ${student.hello:hello}_è€å¸ˆä¸€å·
    teachAge: 20
```



### **æ¾æ•£ç»‘å®š**ï¼š

å®ä½“ç±»ä¸­ä½¿ç”¨ï¼š`private String lastName;`

yamlé…ç½®æ–‡ä»¶ä¸­å±æ€§èµ‹å€¼å¯å†™ï¼š`last-name: ä½ å¥½`

## JSR303æ ¡éªŒ

ç±»ä¸Šä½¿ç”¨æ³¨è§£ï¼š**@Validated**

ç±»ä¼¼æ­£åˆ™è¡¨è¾¾å¼

> @NotNull(message="åå­—ä¸èƒ½ä¸ºç©º")
> private String userName;
>
> @Max(Value=120,message="å¹´é¾„æœ€å¤§ä¸èƒ½æŸ¥è¿‡120")
> private int age;
>
> @Email(message="é‚®ç®±æ ¼å¼é”™è¯¯")
> private String email;
>
> 
>
> **ç©ºæ£€æŸ¥**
> @Null
> éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull
>
> @NotNull
> éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull,æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º8çš„å­—ç¬¦ä¸²
>
> @NotBlank
> æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº9ï¼Œåªå¯¹å­—ç¬¦ä¸²ï¼Œä¸”ä¼šå»æ‰å‰åç©ºæ ¼
>
> @NotEmpty
> æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.
>
> 
>
> **Booleanæ£€æŸ¥**
>
> @AssertTrue
> éªŒè¯Booleanå¯¹è±¡æ˜¯å¦ä¸ºtrue
>
> @AssertFalse
> éªŒè¯Booleanå¯¹è±¡æ˜¯å¦ä¸ºfa1se
>
> 
>
> **é•¿åº¦æ£€æŸ¥**
> @size(min=,max=) éªŒè¯å¯¹è±¡ (Array,Collection,Map,String) é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…
>
> @Length(min=,max=) Validates that the annotated string is between min and max included.
>
> 
>
> **æ—¥æœŸæ£€æŸ¥**
> @Past
> éªŒè¯Dateå’ŒCalendarå¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰
>
> @Future
> éªŒè¯Dateå’ŒCalendarå¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å
>
> @Pattern
> éªŒè¯Stringå¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™ : æ­£åˆ™è¡¨è¾¾å¼
>
> 
>
> ..........ç­‰ç­‰
> é™¤æ­¤ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›æ•°æ®æ ¡éªŒè§„åˆ™



## é…ç½®æ–‡ä»¶

### ä¼˜å…ˆçº§

è¢«è¯»å–çš„å¦‚ï¼šapplication.yamlç­‰é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§

> - **`file:./config/`**
> - **`file:./`**
> - **`classpath:/config/`**
> - **`classpath:/`**



## Springbootå¤šç¯å¢ƒé…ç½®

å¯ä»¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ªé…ç½®æ–‡ä»¶

### properties

ä¾‹å¦‚å·²æœ‰æ–‡ä»¶

> - **application.properties**
> - application-dev.properties
> - application-test.properties

åœ¨**application.properties**æ–‡ä»¶ä¸­ä½¿ç”¨å‚æ•°é€‰æ‹©æ¿€æ´»

`spring.profiles.active=dev`ï¼Œä»£è¡¨æ¿€æ´»application-dev.propertiesé…ç½®æ–‡ä»¶çš„å±æ€§



### yaml

ä»…éœ€ä¸€ä¸ªæ–‡ä»¶ï¼š**application.yaml**

ç”¨ **---** åˆ†éš”ï¼Œ**profiles**æ ‡æ³¨ï¼Œ**active**è¡¨æ˜å¯ç”¨

```yaml
server:
  port: 8080
spring:
  profiles:
    active: dev

---
server:
  port: 8081
spring:
  profiles: dev

---
server:
  port: 8082
spring:
  profiles: test
```



## è‡ªåŠ¨è£…é…åŸç†ç²¾é«“

1. SpringBootå¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»ï¼›
2. æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰åœ¨SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»å½“ä¸­ï¼›
3. æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›(åªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶å­˜åœ¨åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½®äº†)ï¼›
4. ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»**propertiesç±»**ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼å³å¯ï¼›

- **xxxxAutoConfigurationï¼š**è‡ªåŠ¨é…ç½®ç±»ï¼›ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼›
- **xxxxPropertiesï¼š**å°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›



**PSï¼š**å¯ä»¥é€šè¿‡**`debug=true`**æ¥æŸ¥çœ‹å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆäº†ï¼Œå“ªäº›æ²¡æœ‰



# SpringBoot Webå¼€å‘

## webjars

```xml
<dependency>
    <groupId>org.webjars</groupId>
    <artifactId>jquery</artifactId>
    <version>3.6.4</version>
</dependency>
```



## é™æ€èµ„æº

**èƒ½ç›´æ¥è®¿é—®é™æ€èµ„æºçš„æ‰€æœ‰è·¯å¾„ï¼š**

classpath:å³**src/main/resources**

> classpath:
>
> â€‹	/META-INF/resources/
>
> â€‹	/resources/
>
> â€‹	/static/
>
> â€‹	/public/

**ä¼˜å…ˆçº§ï¼š**resources > staticï¼ˆé»˜è®¤ï¼‰ > public



### æ¨¡æ¿å¼•æ“

- **templatesç›®å½•**ä¸‹çš„é¡µé¢åªèƒ½é€šè¿‡**controller**æ¥è·³è½¬
- é»˜è®¤çš„è§†å›¾è§£æå™¨åªèƒ½è·³è½¬.jspé¡µé¢
- å› æ­¤éœ€è¦å¼•å…¥thymeleafä¾èµ–

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>
```



### Thymeleaf

**æ‰€æœ‰çš„htmlå…ƒç´ å±æ€§ï¼Œéƒ½å¯ä»¥è¢«thymeleafæ›¿æ¢æ¥ç®¡**

- åœ¨htmlä¸­ä½¿ç”¨éœ€è¦å¯¼å…¥çº¦æŸ

  ```html
  <html lang="en" xmlns:th="http://www.thymeleaf.org">
  ```

- é˜²æ­¢${xxx}æŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ³¨é‡Š

  ```html
  <!--suppress ThymeleafVariablesResolveInspection -->
  ```



#### è¯­æ³•

##### th:text  /  th:utext

```java
// controlleréƒ¨åˆ†
@GetMapping("/index")
public String index(Model model) {
    model.addAttribute("msg", "<h1>HelloThymeleaf</h1>");
    return "index";
}
```

```html
// html
<div th:text="${msg}">ä½ å¥½</div>
<div th:utext="${msg}">ä½ å¥½</div>
```

- ä½¿ç”¨äº†textçš„å°†ç›´æ¥è¾“å‡ºmsgçš„æ–‡æœ¬å†…å®¹å®Œå®Œå…¨å…¨
- ä½¿ç”¨utextçš„ä¼šå°†msgå†…å®¹ä¸­çš„htmlæ ‡ç­¾è¯†åˆ«ï¼Œå¹¶è¾“å‡ºå…¶ä½™çš„æ–‡æœ¬å†…å®¹



#### th:each

```java
// controlleréƒ¨åˆ†
...
model.addAttribute("users", Arrays.asList("ab", "cd"));
...
```

```html
// htmléƒ¨åˆ†
<div th:each="user:${users}" th:text="${user}"></div>
```



## MVC Config

æ‰©å±•springmvcï¼Œæ‰€ä»¥è¦å®ç° **WebMvcConfigurer**ï¼Œå¯¹ä¸€äº›è¦æ‰©å±•ä¿®æ”¹çš„æ–¹æ³•è¿›è¡ŒOverrideé‡å†™æ“ä½œ

```java
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {
    ...
}
```



### ViewResolver

ViewResolverå®ç°äº†è§†å›¾è§£æå™¨æ¥å£çš„ç±»ï¼Œå› æ­¤å¯å°†å…¶çœ‹ä½œè§†å›¾è§£æå™¨

æ‰©å±•è¯¥è§†å›¾è§£æå™¨åŠŸèƒ½ï¼Œè‡ªå®šä¹‰è¯¥ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨@Beanæ³¨è§£äº¤ç»™SpringBootï¼Œä¼šè‡ªåŠ¨è£…é…

```java
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {
    @Bean
    public ViewResolver myViewResolver(){
        return new MyViewResolver();
    }

    public static class MyViewResolver implements ViewResolver {
        @Override
        public View resolveViewName(String viewName, Locale locale) throws Exception {
            return null;
        }
    }
}
```



### addViewControllers

```java
@Override
public void addViewControllers(ViewControllerRegistry registry) {
    registry.addViewController("/xxx").setViewName("index");
}
```

è®¿é—®/xxxï¼Œè·³è½¬è‡³index



## ç®¡ç†ç³»ç»Ÿå¼€å‘

### å‡†å¤‡å·¥ä½œ

å‡†å¤‡å¥½å‰ç«¯èµ„æº

1. htmlé¡µé¢æ”¾åˆ° 

   > -resources 
   >
   > â€‹	-templates

2. cssã€imgã€jsèµ„æºæ”¾åˆ°

   > -resources
   >
   > â€‹	-static



#### æ¨¡æ‹Ÿæ•°æ®

**æ³¨æ„ï¼š**daoå±‚ç»™springæ‰˜ç®¡ä½¿ç”¨**@Repository**æ³¨è§£

```java
public class DepartmentDao {
    private static Map<Integer, Department> departments = null;

    static {
        departments = new LinkedHashMap<>();
        departments.put(101, new Department(101, "101éƒ¨"));
        departments.put(102, new Department(102, "102éƒ¨"));
        departments.put(103, new Department(103, "103éƒ¨"));
        departments.put(104, new Department(104, "104éƒ¨"));
        departments.put(105, new Department(105, "105éƒ¨"));
        departments.put(106, new Department(106, "106éƒ¨"));
    }

    /**
     * è·å–æ‰€æœ‰æ•°æ®
     */
    public Collection<Department> getDepartments() {
        return departments.values();
    }

    /**
     * æ ¹æ®idè·å–éƒ¨é—¨ä¿¡æ¯
     */
    public Department getDepartment(Integer id) {
        return departments.get(id);
    }

    /**
     * æ ¹æ®idåˆ é™¤éƒ¨é—¨ä¿¡æ¯
     */
    public void deleteDepartment(Integer id) {
        departments.remove(id);
    }

    /**
     * æ–°å¢éƒ¨é—¨ä¿¡æ¯
     */
    public void addDepartment(Department department) {
        departments.put(department.getId(), department);
    }

    /**
     * ä¿®æ”¹éƒ¨é—¨ä¿¡æ¯
     */
    public void updateDepartment(Department department) {
        departments.put(department.getId(), department);
    }
}
```



### é¦–é¡µå®ç°

ä¸ºäº†è®¿é—®

> - localhost:8080
> - localhost:8080/index
> - localhost:8080/index.html

éƒ½èƒ½è·³è½¬åˆ°indexé¡µé¢ï¼Œå¯ä»¥æ‰©å±•é…ç½®MvcConfigğŸ‘‡

```java
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addViewController("/index.html").setViewName("index");
        registry.addViewController("/index").setViewName("index");
    }
}
```



**æ‰€æœ‰çš„é™æ€èµ„æºè¢«Thymeleafæ¥ç®¡ï¼Œå¼•ç”¨é™æ€èµ„æºæ–‡ä»¶ï¼ˆcss..ï¼‰ğŸ‘‡**

> -resources
>
> â€‹	-static
>
> â€‹		-css
>
> â€‹		-js
>
> â€‹		-img

ä½¿ç”¨@{}å¯ä»¥å¿½ç•¥static

```html
<link th:href="@{/css/index.css}" rel="stylesheet">
```



**å…³é—­æ¨¡æ¿å¼•æ“ç¼“å­˜ğŸ‘‡**

```properties
spring.thymeleaf.cache=false
```



**æ‹¼æ¥è·¯å¾„ï¼š**

```properties
server.servlet.context-path=/xxx
```

ä¾‹å¦‚ï¼šåŸæœ¬è®¿é—®localhost:8080/index.htmlå³å¯

é…ç½®è·¯å¾„åï¼Œè®¿é—®çš„æ˜¯localhost:8080/xxx/index.html



### å›½é™…åŒ–

ç‚¹å‡»åˆ‡æ¢ä¸­è‹±æ–‡ä¹‹ç±»çš„ç©æ„..

1. é¦–å…ˆç¡®ä¿é¡¹ç›®çš„æ‰€æœ‰å­—ç¬¦ç¼–ç ä¸º**utf-8**ï¼ˆfileEncodings)

2. resourcesä¸‹æ–°å»ºç›®å½•ï¼š**i18n**(internationalization ï¼ˆå›½é™…åŒ–ï¼‰ç®€ç§°ï¼ši18n)

3. i18nç›®å½•ä¸‹æ–°å¢é…ç½®æ–‡ä»¶ï¼š**login.properties** / **login_zn_CN.properties**

   ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ª**Resource Bundle'login'**

   éœ€è¦æ–°å¢åˆ«çš„è¯­è¨€å¯ä»¥ç›´æ¥åœ¨Resource Bundleä¸Šå³é”®æ–°å¢é…ç½®æ–‡ä»¶ï¼Œå³ä¾§â€+â€œï¼Œè¾“å…¥**en_US**æ–°å¢è‹±è¯­..

4. ä¸‹è½½å¯è§†åŒ–ç¼–è¾‘æ’ä»¶ **Resource Bundle Editor**

5. è¿›å…¥login.propertiesï¼ŒIDEAä¸‹æ–¹é€‰æ‹©Resource Bundleï¼Œåœ¨loginä¸Šç‚¹å‡»â€+â€œæ·»åŠ å‚æ•°

   å³ä¾§å°±ä¼šå‡ºç°æ‰€æœ‰login_xxxçš„ç›¸å…³propertiesè¾“å…¥æ¡†é…ç½®ä¸åŒçš„å‚æ•°å€¼



**å°†ä»¥ä¸Šé…ç½®ä½¿ç”¨èµ·æ¥**

1. ç¡®è®¤è½¬æ¢ä½ç½®

   æœ‰ä¸€ä¸ªç±»ï¼šMessageSourceAutoConfigurationï¼Œåšè‡ªåŠ¨åŒ–å›½é™…è½¬æ¢

   åœ¨**application.properties**ä¸­é…ç½®è¯†åˆ«

   ```properties
   spring.messages.basename=i18n.login
   ```

2. åœ¨Thymeleafä¸­ï¼Œéœ€è¦ç”¨åˆ°å›½é™…åŒ–è½¬æ¢æ–‡å­—çš„åœ°æ–¹ä½¿ç”¨

   th:text="#{login.tip}"

   ```html
   <h1>[[#{login.tip}]]</h1>
   <input type="submit" th:value="#{login.btn}"/>
   ```

3. è¯­è¨€åˆ‡æ¢æŒ‰é’®åŠè·³è½¬**è¯·æ±‚å‚æ•°ï¼ˆlï¼‰**

   ```html
   <a th:href="@{/index.html(l='zh_CN')}">ä¸­æ–‡</a>
   <a th:href="@{/index.html(l='en_US')}">English</a>
   ```

4. ç¼–è¾‘å®ç°**åŒºåŸŸè§£æå™¨ï¼ˆLocaleResolverï¼‰**ç»„ä»¶

   ```java
   public class MyLocaleResolver implements LocaleResolver {
       @Override
       public Locale resolveLocale(HttpServletRequest request) {
           String language = request.getParameter("l");// è·å–è¯·æ±‚è¯­è¨€å‚æ•°
           Locale locale = Locale.getDefault();// è·å–é»˜è®¤çš„
           // è¯·æ±‚è¿æ¥æ˜¯å¦æºå¸¦å›½é™…åŒ–å‚æ•°
           if (!StringUtils.isEmpty(language)){
               String[] split = language.split("_");
               return new Locale(split[0],split[1]);
           }
           return locale;
       }
   
       @Override
       public void setLocale(HttpServletRequest request, 
                             HttpServletResponse response, 
                             Locale locale) {
   
       }
   }
   ```

5. åœ¨**MvcConfig**ä¸­æ³¨å…¥è¯¥è‡ªå®šä¹‰ç»„ä»¶

   ```java
   @Configuration
   public class MyMvcConfig implements WebMvcConfigurer {
       @Bean
       public LocaleResolver localeResolver(){
           return new MyLocaleResolver();
       }
   }
   ```



### è§£å†³é—®é¢˜

ç™»å½•åè¿›å…¥çš„é¡µé¢ï¼Œåœ°å€æ æ˜¾ç¤ºçš„æ˜¯ /user/login?username=xxx

æ¨¡æ‹ŸçœŸå®å¼€å‘ï¼Œåœ¨controllerå†…è·³è½¬é¡µé¢è¦é‡å®šå‘ï¼Œå¹¶åœ¨mvcé…ç½®ä¸­é…ç½®é‡å®šå‘åœ°å€æ‰“å¼€å“ªä¸ªé¡µé¢

ä¾‹å¦‚ï¼šé‡å®šå‘åˆ°main.htmlï¼Œæ‰“å¼€çš„é¡µé¢æ˜¯homePage

```java
@RequestMapping("/login")
public String login(@RequestParam("username") String username,
                    @RequestParam("pwd") String pwd,
                    Model model) {
    if (Objects.equals(username, "a") && Objects.equals(pwd, "a")){
        // ç™»é™†æˆåŠŸ
        return "redirect:/main.html";
    }else {
        model.addAttribute("msg","ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼");
        return "index";
    }
}
```

```java
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/main.html").setViewName("homePage");
    }
}
```



### æ‹¦æˆªå™¨

1. ç¼–å†™ä¸€ä¸ªLoginHandlerInterceptorç±»

   å®ç°HandlerInterceptorç±»

   é‡å†™preHandleæ–¹æ³•

   ```java
   public class LoginHandlerInterceptor implements HandlerInterceptor {
       @Override
       public boolean preHandle(HttpServletRequest request, 
                                HttpServletResponse response, 
                                Object handler) throws Exception {
           Object loginUser = request.getSession().getAttribute("loginUser");
           if (loginUser == null) {
               // æœªç™»å½•
               request.setAttribute("msg", "æ²¡æœ‰æƒé™ï¼Œè¯·å…ˆç™»å½•");
               request.getRequestDispatcher("/index.html").forward(request, response);
               return false;
           }
           return true;
       }
   }
   ```

2. åœ¨MvcConfigä¸­æ³¨å…¥è¯¥æ‹¦æˆªå™¨

   å¹¶æ·»åŠ éœ€è¦æ‹¦æˆªçš„é¡µé¢ï¼Œä¸éœ€è¦è¢«æ‹¦æˆªçš„é¡µé¢..

   ```java
   @Configuration
   public class MyMvcConfig implements WebMvcConfigurer {
       @Override
       public void addInterceptors(InterceptorRegistry registry) {
           registry.addInterceptor(new LoginHandlerInterceptor())
                   .addPathPatterns("/**")
                   .excludePathPatterns("/index.html","/","/user/login","/css/**","/js/**","/img/**");
       }
   }
   ```

3. ä½¿ç”¨Thymeleafä¸­çš„æ–¹æ³•å–sessionå€¼æ”¾å…¥é¡µé¢

   ```html
   <h1>ç™»é™†æˆåŠŸï¼æ¬¢è¿[[${session.loginUser}]]è¿›å…¥é¦–é¡µï¼</h1>
   ```



### ThymeleafæŠ½å–å‰ç«¯å¤ç”¨æ€§ç»„ä»¶

**æ³¨æ„ï¼š**å¤ç”¨æ€§é«˜çš„ä¸€äº›éƒ¨åˆ†å»ºè®®æ”¾åˆ°å…¬å…±é¡µé¢ï¼ˆcommon.htmlï¼‰ï¼Œè¿›è¡ŒæŠ½å–è°ƒç”¨

- è¢«æŠ½å–çš„éƒ¨åˆ†ï¼Œä½¿ç”¨`th:fragment="å"`

  ```html
  <div class="side_bar" th:fragment="side_bar"></div>
  ```

- ä½¿ç”¨æŠ½å–åˆ°çš„éƒ¨åˆ†ï¼š`th:insert="~{é¡µé¢::å}"`ï¼Œä¹Ÿå¯ä»¥ç”¨`th:replace`ï¼Œä¸`th:insert`ä½¿ç”¨æ–¹æ³•ç›¸åŒ

  ```html
  <div th:insert="~{homePage::side_bar}"></div>
  ```

- ååé¢æ˜¯å¯ä»¥**ä¼ å‚æ•°**çš„ï¼Œç”¨ä»¥è¡¨ç¤ºå½“å‰ä½¿ç”¨æŠ½å–éƒ¨åˆ†çš„é¡µé¢æ˜¯å“ªä¸ªé¡µé¢ï¼Œæ–¹ä¾¿å…¬å…±éƒ¨åˆ†æ˜¾ç¤ºä¸åŒçš„æ ·å¼

  **ä¾‹å¦‚ï¼š**

  > ä½¿ç”¨æŠ½å–çš„é¡µé¢ï¼š`th:replace="~{commons/commons::side_bar(active='list.html')}"`
  >
  > è¢«æŠ½å–çš„é¡µé¢ï¼š`th:class="@active=='list.html'?'active b':'b'"`
  >
  > é€šè¿‡ä½¿ç”¨æŠ½å–é¡µé¢ä¼ æ¥çš„å‚æ•°ï¼Œå†³å®šclassçš„å€¼ä¸åŒ

  ```html
  <div class="side_bar" th:fragment="side_bar">
      <ul>
          <li>
              <a th:href="@{/index.html}" th:class="${active=='index.html' ? 'active ab' : 'ab'}">
                  ä¸ªäººä¸­å¿ƒ
              </a>
          </li>
          <li th:class="${active=='list.html' ? 'active ab' : 'ab'}">
              <a th:href="@{/emps}" th:class="${active=='list.html' ? 'active ab' : 'ab'}">
                  å‘˜å·¥ç®¡ç†
              </a>
          </li>
      </ul>
  </div>
  ```

  ```html
  <div th:replace="~{commons/commons::side_bar(active = 'index.html')}"></div>
  ```



### å‰ç«¯å°ä¿®æ”¹

æ ¼å¼åŒ–æ—¥æœŸ

```html
<td th:text="${#dates.format(emp.birth,'yyyy-MM-dd HH:mm:ss')}"></td>
```





### 404

templatesä¸‹æ–°å»ºerrorç›®å½•ï¼Œerrorç›®å½•ä¸‹æ–°å»º404.htmlé¡µé¢å³å¯è‡ªåŠ¨è¯†åˆ«

å¦‚æœæœ‰æ‹¦æˆªå™¨ï¼Œç™»é™†åæ‰ä¼šè®¿é—®åˆ°404é¡µé¢





## Druidæ•°æ®æº

### æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.1.23</version>
</dependency>
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

**æ³¨æ„ï¼š**å› ä¸ºDruidåŒ…å«log4jï¼Œå› æ­¤è¿˜éœ€è¦å¼•å…¥log4jçš„ä¾èµ–



### Yamlæ–‡ä»¶ä¸­é…ç½®è‡ªå®šä¹‰çš„æ•°æ®æº

```yaml
spring:
  datasource:
    username: root
    password: 123456
    url: jdbc:mysql://localhost:3306/mybatis?useSSL=true&userUniceode=true&characterEncoding=utf8
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource
```



### Druidç›¸å…³é…ç½®

```yaml
  #Spring Boot é»˜è®¤æ˜¯ä¸æ³¨å…¥è¿™äº›å±æ€§å€¼çš„ï¼Œéœ€è¦è‡ªå·±ç»‘å®š
    #druid æ•°æ®æºä¸“æœ‰é…ç½®
    initialSize: 5
    minIdle: 5
    maxActive: 20
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 60000
    minEvictableIdleTimeMillis: 300000
    validationQuery: SELECT 1 FROM DUAL
    testWhileIdle: true
    testOnBorrow: false
    testOnReturn: false
    poolPreparedStatements: true

    #é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œstat:ç›‘æ§ç»Ÿè®¡ã€log4jï¼šæ—¥å¿—è®°å½•ã€wallï¼šé˜²å¾¡sqlæ³¨å…¥
    #å¦‚æœå…è®¸æ—¶æŠ¥é”™  java.lang.ClassNotFoundException: org.apache.log4j.Priority
    #åˆ™å¯¼å…¥ log4j ä¾èµ–å³å¯ï¼ŒMaven åœ°å€ï¼šhttps://mvnrepository.com/artifact/log4j/log4j
    filters:
      commons-log.connection-logger-name: stat,wall,log4j
    maxPoolPreparedStatementPerConnectionSize: 20
    useGlobalDataSourceStat: true
    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
```



### æ–°å»ºConfigé…ç½®æ–‡ä»¶

ç°åœ¨éœ€è¦ç¨‹åºå‘˜è‡ªå·±ä¸º DruidDataSource ç»‘å®šå…¨å±€é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ï¼Œå†æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œè€Œä¸å†ä½¿ç”¨ Spring Boot çš„è‡ªåŠ¨ç”Ÿæˆäº†ï¼›æˆ‘ä»¬éœ€è¦ è‡ªå·±æ·»åŠ  DruidDataSource ç»„ä»¶åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ç»‘å®šå±æ€§

> -config
>
> â€‹	-DruidConfig.java

```java
@Configuration
public class DruidConfig {
    @Bean
    @ConfigurationProperties(prefix = "spring.datasource")
    //ç»‘å®šåˆ°application.xmlæ–‡ä»¶ä¸­ ç”Ÿæ•ˆ
    public DataSource druidDateSource(){
        return new DruidDataSource();
    }
}
```



#### åå°ç›‘æ§







# SpringSecurity

## å®‰å…¨æ¡†æ¶

- SpringSecurityï¼šèº«ä»½è®¤è¯ã€æˆæƒ
- Shiro
- **ä¸¤è€…ç±»ä¼¼**



## ç®€ä»‹

SpringSecurityï¼š

- é’ˆå¯¹Springé¡¹ç›®çš„å®‰å…¨æ¡†æ¶ï¼Œä¹Ÿæ˜¯SpringBootåº•å±‚å®‰å…¨æ¨¡å—é»˜è®¤çš„æŠ€æœ¯é€‰å‹
- å¯ä»¥å®ç°Webå®‰å…¨æ§åˆ¶ï¼Œä»…éœ€è¦å¼•å…¥spring-boot-starter-securityæ¨¡å—ï¼Œè¿›è¡Œå°‘é‡é…ç½®



## é‡è¦çš„ç±»

- WebSecurityConfigurerAdapterï¼šè‡ªå®šä¹‰Securityç­–ç•¥
- AuthenticationManagerBuilderï¼šè‡ªå®šä¹‰è®¤è¯ç­–ç•¥
- @EnableWebSecurityï¼šå¼€å¯WebSecurityæ¨¡å¼

> Spring Securityçš„ä¸¤ä¸ªä¸»è¦ç›®æ ‡æ˜¯**"è®¤è¯"**å’Œ**"æˆæƒ"**ï¼ˆè®¿é—®æ§åˆ¶ï¼‰
>
> "è®¤è¯"ï¼ˆAuthenticationï¼‰
>
> "æˆæƒâ€ï¼ˆAuthorizationï¼‰
>
> è¿™ä¸ªæ¦‚å¿µæ˜¯é€šç”¨çš„ï¼Œè€Œä¸æ˜¯åªåœ¨Spring Securityä¸­å­˜åœ¨ã€‚



## å¯¼åŒ…

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```



## SecurityConfig

> ***<u>WebSecurityConfigurerAdapteråœ¨SpringSecurity5.7ä¸­å·²å¼ƒç”¨</u>***
>
> ä¸‹é¢çš„æµ‹è¯•æ ·ä¾‹ä½¿ç”¨ç‰ˆæœ¬ï¼š
>
> **æµ‹è¯•SpringSecurity5.7ä»¥ä¸‹ï¼ˆWebSecurityConfigurerAdapter<u>*æœªå¼ƒç”¨*</u>çš„ç‰ˆæœ¬ï¼‰**
>
> - Javaï¼š8
> - SpringBootï¼š2.2.2.RELEASE
> - SpringSecurityï¼š5.2.0.RELEASE
> - æ–‡æ¡£åœ°å€ï¼š[Spring Security Reference](https://docs.spring.io/spring-security/site/docs/5.2.0.RELEASE/reference/htmlsingle/)
>
> 
>
> **æµ‹è¯•SpringSecurity5.7åŠä»¥ä¸Šï¼ˆWebSecurityConfigurerAdapter<u>*å·²å¼ƒç”¨*</u>çš„ç‰ˆæœ¬ï¼‰**
>
> - Javaï¼š17
> - SpringBootï¼š3.2.2



### ç”¨æˆ·è®¤è¯å’Œæˆæƒï¼ˆä»¥ç›´æ¥åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡ŒéªŒè¯ï¼‰

> -config
>
> â€‹	-SecurityConfig

> **è¯´æ˜ï¼š**
>
> - passwordEncoder(new BCryptPasswordEncoder())ï¼šå¯†ç ç¼–ç æ–¹å¼

```java
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    // æˆæƒ
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        // é¦–é¡µæ‰€æœ‰äººå¯ä»¥è®¿é—®ï¼ŒåŠŸèƒ½é¡µåªæœ‰å¯¹åº”æƒé™çš„äººæ‰èƒ½è®¿é—®
        http.authorizeRequests()
                .antMatchers("/").permitAll()
                .antMatchers("/level1/**").hasRole("vip1")
                .antMatchers("/level2/**").hasRole("vip2")
                .antMatchers("/level3/**").hasRole("vip3");

        // æ²¡æœ‰æƒé™ï¼Œé»˜è®¤åˆ°ç™»é™†é¡µé¢
        http.formLogin();
    }

    // è®¤è¯
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.inMemoryAuthentication()
                .passwordEncoder(new BCryptPasswordEncoder())
                .withUser("admin1").password(new BCryptPasswordEncoder().encode("admin1")).roles("vip1", "vip3")
                .and()
                .withUser("admin2").password(new BCryptPasswordEncoder().encode("admin2")).roles("vip1", "vip2");
    }
}
```



### æ³¨é”€

> -config
>
> â€‹	-SecurityConfig

> **è¯´æ˜ï¼š**
>
> logoutSuccessUrlï¼šæŒ‡å®šæ³¨é”€æˆåŠŸè·³è½¬çš„é¡µé¢

```java
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    // æˆæƒ
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.logout().logoutSuccessUrl("/");
    }
}
```



## Security-Thymeleaf

**éœ€æ±‚ï¼š**

1. å®ç°æœªç™»å½•çœ‹åˆ°ï¼šç™»å½•æŒ‰é’®ï¼Œå·²ç™»å½•çœ‹åˆ°ï¼šç”¨æˆ·ååŠæ³¨é”€æŒ‰é’®
2. ä¸åŒè§’è‰²çš„ç”¨æˆ·ç™»å½•ï¼Œçœ‹åˆ°çš„æ¨¡å—ä¹Ÿä¸åŒ



### å¯¼åŒ…

**æ³¨æ„ç‰ˆæœ¬å¯¹åº”ï¼**

> SpringBootï¼š**<u>2.2.2.RELEASE</u>**
>
> thymeleaf-extras-springsecurityï¼š**<u>5</u>** / **<u>3.0.4.RELEASE</u>**

```xml
<dependency>
    <groupId>org.thymeleaf.extras</groupId>
    <artifactId>thymeleaf-extras-springsecurity5</artifactId>
    <version>3.0.4.RELEASE</version>
</dependency>
```



**HTMLæ ‡ç­¾å†…å¼•å…¥é“¾æ¥**

```html
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
```



### é¡µé¢ä¿®æ”¹

- **å¦‚æœæœªç™»å½•ï¼š**æ˜¾ç¤º**ç™»é™†**æŒ‰é’®
- **å¦‚æœå·²ç™»å½•ï¼š**æ˜¾ç¤º**ç”¨æˆ·å**å’Œ**æ³¨é”€**æŒ‰é’®

```html
<!--æœªç™»å½•-->
<div sec:authorize="!isAuthenticated()">
    <a class="item" th:href="@{/toLogin}">
        <i class="address card icon"></i> ç™»å½•
    </a>
</div>

<div sec:authorize="isAuthenticated()">
    <!--å·²ç™»å½•ï¼šç”¨æˆ·å-->
    <a class="item">
        ç”¨æˆ·åï¼š<span sec:authentication="name"></span>
        è§’è‰²ï¼š<span sec:authentication="authorities"></span>
    </a>
    <!--å·²ç™»å½•ï¼šæ³¨é”€-->
    <a class="item" th:href="@{/logout}">
        <i class="sign-out icon"></i> æ³¨é”€
    </a>
</div>
```



- æ ¹æ®å·²ç™»é™†è§’è‰²çš„ä¸åŒï¼Œæ˜¾ç¤ºä¸åŒçš„div
- `sec:authorize="hasRole('xxx')"`

```html
<div class="column" sec:authorize="hasRole('vip1')">
```



### è®°ä½æˆ‘åŠŸèƒ½

> -config
>
> â€‹	-SecurityConfig

> **è¯´æ˜ï¼š**
>
> è®°ä½æˆ‘åŠŸèƒ½å¼€å¯çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯ç±»ä¼¼äºç»™äº†ä¸€ä¸ªä»¤ç‰Œï¼Œå…³é—­æµè§ˆå™¨å†æ¬¡è¿›å…¥ä¸ç”¨å†æ¬¡ç™»å½•
>
> æœ‰æ•ˆæœŸé»˜è®¤ä¸¤å‘¨ï¼ˆ14å¤©ï¼‰

```java
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    // æˆæƒ
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        // å¼€å¯ è®°ä½æˆ‘ åŠŸèƒ½
        http.rememberMe();
    }
}
```





### å®šåˆ¶ä¸ºè‡ªå·±çš„Loginé¡µé¢

> - loginPageï¼šå®šä½ç™»é™†é¡µé¢
> - usernameParameterï¼šè®¾ç½®å‰ç«¯ç”¨æˆ·åå‚æ•°å¯¹åº”çš„name
> - passwordParameterï¼šè®¾ç½®å‰ç«¯å¯†ç å‚æ•°å¯¹åº”çš„name
> - loginProcessingUrlï¼šè®¾ç½®æäº¤ç™»å½•è¯·æ±‚çš„urlï¼ˆform action:"/login"ï¼‰

```java
http.formLogin().loginPage("/toLogin")
                .usernameParameter("username")
                .passwordParameter("password")
                .loginProcessingUrl("/login");
```



### è®¾ç½®"è®°ä½æˆ‘"å‚æ•°

```java
http.rememberMe().rememberMeParameter("remember");
```













































# é¢˜å¤–

## Thymeleafæ ‡æ³¨

> Simple expressions:
>
> Variable Expressions: **`${...}`**
>
> Selection Variable Expressions: **`*{...}`**
>
> Message Expressions: **`#{...}`**
>
> Link URL Expressions: **`@{...}`**
>
> Fragment Expressions: **`~{...}`**





## kuangæ¨è

SemanticUI































































