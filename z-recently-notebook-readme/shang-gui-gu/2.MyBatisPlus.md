## ç‰¹åˆ«é¸£è°¢ - è§†é¢‘æ•™ç¨‹

https://www.bilibili.com/video/BV12R4y157Be



## è‡ªå¸¦åˆ†é¡µæ’ä»¶

### 1.ç¼–å†™é…ç½®ç±»

> -config
>
> â€‹	-MyBatisPlusConfig.java

```java
@Configuration
@MapperScan("com.chenix.mapper")
public class MyBatisPlusConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor(){
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```

### 2.ä½¿ç”¨selectPageæµ‹è¯•

```java
@Test
public void test01() {
    Page<Books> page = new Page<>(2, 3);
    booksMapper.selectPage(page, null);
    System.out.println(page);
}
```

### 3.ä½¿ç”¨Pageå‚æ•°è‡ªå®šä¹‰æ–¹æ³•

```java
Page<Books> selectPageByPrice(@Param("pageParam") Page<Books> pageParam,
                              @Param("min") Integer min,
                              @Param("max") Integer max);
```

**æ³¨ï¼š**Page<T>å½¢å‚æ”¾åœ¨æœ€å‰é¢ï¼Œè¿”å›å€¼ä¹Ÿä¸ºPage<T>ï¼Œå…¶ä½™æ­£å¸¸å†™ğŸ‘† ğŸ‘‡

```xml
<select id="selectPageByPrice" resultType="com.chenix.pojo.Books">
    SELECT *
    FROM bookdb.t_book
    WHERE price BETWEEN #{min} AND #{max}
</select>
```



## ä¹è§‚é” & æ‚²è§‚é”

### åœºæ™¯

> ä¸€ä»¶å•†å“æˆæœ¬80ï¼Œå”®ä»·100
>
> å‘˜å·¥Aè¢«è¦æ±‚è°ƒé«˜å”®ä»·+50ï¼Œ-> 150
>
> è€æ¿è§‰å¾—150é«˜äº†ï¼Œè¦æ±‚å‘˜å·¥Bè°ƒä½å”®ä»·-30 -> 120
>
> ä½†æ˜¯å‘˜å·¥Aå› ä¸ºæŸäº›åŸå› è€½æäº†ï¼Œå’Œå‘˜å·¥B**åŒæ—¶æ“ä½œäº†**
>
> é‚£ä¹ˆå‘˜å·¥Aåœ¨ç³»ç»Ÿä¸­è·å–å•†å“ä»·æ ¼ä¸º100ï¼Œ+50
>
> å‘˜å·¥Båœ¨ç³»ç»Ÿä¸­è·å–å•†å“ä»·æ ¼ä¸º100ï¼Œ-30
>
> ï¼ˆåŒæ—¶æ‹¿åˆ°100çš„å”®ä»·ï¼Œå‘˜å·¥Aå…ˆæäº¤äº†è°ƒæ•´ä¸º150çš„ä»·æ ¼ï¼Œè€Œåå‘˜å·¥Bæäº¤äº†-30çš„ä»·æ ¼ï¼Œå˜ä¸º70ï¼‰
>
> æ­¤æ—¶å‘˜å·¥Bå°†è¦†ç›–å‘˜å·¥Açš„æ“ä½œï¼Œæœ€ç»ˆä»·æ ¼ = 70 < æˆæœ¬

### ä¹è§‚é”ä¸æ‚²è§‚é”

å¦‚ä¸Šåœºæ™¯ï¼Œä¸¤é”åŒºåˆ«ï¼š

- ä¹è§‚é”ï¼šå‘˜å·¥Bè°ƒæ•´ä»·æ ¼ï¼Œæ­£å¼æäº¤ä¹‹å‰ï¼Œæ£€æŸ¥ä»·æ ¼æ˜¯å¦è¢«ä¿®æ”¹ï¼ˆæ ¹æ®**ç‰ˆæœ¬å·ï¼‰**
  - ä¿®æ”¹äº†ï¼šé‡æ–°æ‹¿å–ä¿®æ”¹åçš„ä»·æ ¼
- æ‚²è§‚é”ï¼šå‘˜å·¥Aä½¿ç”¨100è¿™ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå‘˜å·¥Bæ— æ³•æ“ä½œ

### ä¹è§‚é”å®ç°

1. åœ¨æ•°æ®è¡¨ä¸­æ·»åŠ versionå­—æ®µ

2. å–å‡ºè®°å½•çš„æ—¶å€™ï¼Œè·å–å½“å‰çš„version

   ```sql
   select x1,x2,version from x_table where id = 1;
   ```

3. æ›´æ–°è®°å½•çš„æ—¶å€™ï¼ŒåŒ¹é…ä¸Šæ¬¡å–å‡ºçš„versionå­—æ®µ -> åŒ¹é…å¤±è´¥é‡æ–°è·å–åŒ¹é…

   ```sql
   update x_table set x1 = x1 + 10, version = version + 1 where id = 1 and version = {{ä¸Šæ¬¡å–å‡ºç‰ˆæœ¬å·}}
   ```

### ä½¿ç”¨MyBatisPlusæä¾›çš„ä¹è§‚é”æ’ä»¶å®ç°

1. ä¿®æ”¹å®ä½“ç±»ï¼Œ åŠ ä¸Šä¹è§‚é”ç‰ˆæœ¬å­—æ®µ

   **é€šè¿‡@Versionæ ‡è¯†ä¸ºä¹è§‚é”ç‰ˆæœ¬å·å­—æ®µ**

   ```java
   @Data
   pulic class Good {
   	...
   	@Version
   	private Integer version;
   }
   ```

2. ä¿®æ”¹é…ç½®ç±»ï¼Œæ·»åŠ ä¹è§‚é”æ’ä»¶

   > -config
   >
   > â€‹	-MyBatisPlus.java

   ```java
   @Configuration
   @MapperScan("com.chenix.mapper")
   public class MyBatisPlusConfig{
       @Bean
       public MybatisPlusInterceptor mybatisPlusInterceptor(){
           MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
           ...
           //ä¹è§‚é”æ’ä»¶
           interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
           return interceptor;
       }
   }
   ```

3. æµ‹è¯•

   ä¸æ·»åŠ ä¹è§‚é”æ—¶ï¼ŒAå’ŒBåŒæ—¶è·å–åŸä»·æ ¼ï¼ŒAæ›´æ–°+50ï¼ŒBæ›´æ–°-30ï¼Œæœ€ç»ˆä»·æ ¼å°±æ˜¯åŸä»·æ ¼-30 -> ä½†æˆ‘ä»¬éœ€è¦åŸä»·æ ¼+50-30

   åœ¨æ·»åŠ ä¹è§‚é”åï¼ŒAå’ŒBè·å–åŸä»·æ ¼ä¿¡æ¯çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªversionå­—æ®µï¼Œå½“Aå’ŒBæ›´æ–°çš„æ—¶å€™ï¼Œä¼šåŒ¹é…è‡ªå·±æ‹¿åˆ°çš„é‚£ä¸ªversionå­—æ®µï¼ŒversionåŒ¹é…å¤±è´¥å°±æ›´æ–°å¤±è´¥

   ```java
   @Test
   public void test01(){
       // å‘˜å·¥AæŸ¥è¯¢ä¹¦ç±ä¿¡æ¯
       Books bookA = booksMapper.selectById(1);
       // å‘˜å·¥BæŸ¥è¯¢ä¹¦ç±ä¿¡æ¯
       Books bookB = booksMapper.selectById(1);
   
       bookA.setPrice(bookA.getPrice() + 50);
       bookB.setPrice(bookB.getPrice() - 30);
   
       booksMapper.updateById(bookA);
       booksMapper.updateById(bookB);
   
       System.out.println(booksMapper.selectById(1));
   }
   ```

4. å…³äºé‡è¯•..

   è·å–Bå‘˜å·¥æ›´æ–°çš„è¡Œæ•°ï¼Œå¦‚æœä¸º0ï¼Œåˆ™é‡è¯•



## é€šç”¨æšä¸¾

### 1.é…ç½®æ–‡ä»¶ä¸­æ‰«ææšä¸¾åŒ…

```yaml
mybatis-plus:
  ...
  type-enums-package: com.xxx.enums
```

### 2.ç¼–å†™æšä¸¾ç±»

> -enums
>
> â€‹	-SexEnum.java

**æ³¨æ„ï¼ï¼**ä¸æ•°æ®è¡¨ä¸­å¯¹åº”çš„å­—æ®µè¦ç”¨**`@EnumValue`**æ³¨è§£æ ‡è®°

```java
@Getter
public enum SexEnum {
    MALE(0,"ç”·"),

    FEMALE(1,"å¥³");

    @EnumValue
    private final Integer sex;

    private final String sexName;

    SexEnum(Integer sex, String sexName) {
        this.sex = sex;
        this.sexName = sexName;
    }
}
```

### 3.å®ä½“ç±»ä¸­ä½¿ç”¨æšä¸¾ç±»

```java
public class User {
  	...
    private SexEnum sex;
}
```



## ä»£ç ç”Ÿæˆå™¨

### å¼•å…¥ä¾èµ–

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-generator</artifactId>
    <version>3.5.1</version>
</dependency>
<dependency>
    <groupId>org.freemarker</groupId>
    <artifactId>freemarker</artifactId>
    <version>2.3.31</version>
</dependency>
```

### åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¯åŠ¨

```java
public class FastGetCodeTest {
    public static void main(String[] args) {
        String url= "jdbc:mysql://localhost:3306/bookdb?characterEncoding=utf8&useSSL=false&serverTimezone=GMT%2B8&rewriteBatchedStatements=true&allowPublicKeyRetrieval=true";
        String username= "root";
        String password= "20011215";
        FastAutoGenerator.create(url, username, password)
                .globalConfig(builder -> {
                    builder.author("baomidou") // è®¾ç½®ä½œè€…
//                            .enableSwagger() // å¼€å¯ swagger æ¨¡å¼
                            .fileOverride() // è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶
                            .outputDir("D:\\"); // æŒ‡å®šè¾“å‡ºç›®å½•
                })
                .packageConfig(builder -> {
                    builder.parent("com.baomidou") // è®¾ç½®çˆ¶åŒ…å
                            .moduleName("mybatisplus") // è®¾ç½®çˆ¶åŒ…æ¨¡å—å
                            .pathInfo(Collections.singletonMap(OutputFile.mapperXml, "D:\\")); // è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„
                })
                .strategyConfig(builder -> {
                    builder.addInclude("t_order") // è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å
                            .addTablePrefix("t_", "c_"); // è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€
                })
                .templateEngine(new FreemarkerTemplateEngine()) // ä½¿ç”¨Freemarkerå¼•æ“æ¨¡æ¿ï¼Œé»˜è®¤çš„æ˜¯Velocityå¼•æ“æ¨¡æ¿
                .execute();
    }
}
```



## å¤šæ•°æ®æº

> **å®˜æ–¹å‚è€ƒï¼š**[å¤šæ•°æ®æº | MyBatis-Plus (baomidou.com)](https://baomidou.com/pages/a61e1b/#dynamic-datasource)





























